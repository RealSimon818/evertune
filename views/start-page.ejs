<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
  <title>Start Work - Evertune</title>
  <link rel="icon" href="/images/bestbuy-logo.png" type="image/x-icon">
  
  <!-- Bootstrap 5 CSS -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
  <!-- Bootstrap Icons -->
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.1/font/bootstrap-icons.css">
  <!-- Google Fonts -->
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@300;400;500;600;700&family=Manrope:wght@300;400;500;600;700&family=DM+Sans:wght@500&display=swap" rel="stylesheet">
  
  <style>
    /* Evertune Brand Design System */
    :root {
      --brand-coral: #F7594E;
      --pure-white: #FFFFFF;
      --deep-black: #1B1B1B;
      --cream-peach: #FFF9F6;
      --teal-turquoise: #69D7DE;
      --warm-beige: #F9DCB7;
      --off-white: #FDFEFE;
      --gray-medium: #6C757D;
      --gray-light: #E9ECEF;
      --card-shadow: 0 4px 14px rgba(0,0,0,0.08);
      --gradient-bg: linear-gradient(135deg, var(--cream-peach) 0%, var(--warm-beige) 50%, var(--teal-turquoise) 100%);
    }
    
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
      font-family: 'Manrope', sans-serif;
    }
    
    body {
      background-color: var(--off-white);
      color: var(--deep-black);
      overflow-x: hidden;
          }
    
    h1, h2, h3, h4, h5, h6, .navbar-brand {
      font-family: 'Montserrat', sans-serif;
      font-weight: 600;
    }
    
    .btn-primary {
      background-color: var(--brand-coral);
      border: none;
      border-radius: 50px;
      padding: 10px 24px;
      font-weight: 500;
      font-family: 'DM Sans', sans-serif;
      transition: all 0.3s ease;
    }
    
    .btn-primary:hover {
      background-color: #e04a40;
      transform: translateY(-2px);
      box-shadow: 0 8px 20px rgba(247, 89, 78, 0.3);
    }
    
    /* Navbar Styles - Matching Home Page */
    .navbar {
      background: var(--pure-white);
      box-shadow: 0 2px 10px rgba(0,0,0,0.05);
      padding: 15px 0;
      position: fixed;
      top: 0;
      left: 0;
      right: 0;
      z-index: 1030;
      height: 70px;
    }
    
    .navbar-container {
      width: 100%;
      max-width: 1200px;
      margin: 0 auto;
      padding: 0 15px;
      display: flex;
      justify-content: space-between;
      align-items: center;
    }
    
    .navbar-left {
      display: flex;
      align-items: center;
      flex: 1;
    }
    
    .navbar-right {
      display: flex;
      align-items: center;
      justify-content: flex-end;
      flex: 1;
      gap: 15px;
    }
    
    .logo-wrapper {
      display: flex;
      align-items: center;
    }
    
    .evertune-logo {
      width: 136px;
      height: 32px;
    }
    
    /* Profile Dropdown Menu */
    .profile-dropdown {
      position: relative;
    }
    
    .hamburger-menu {
      background: none;
      border: none;
      font-size: 1.8rem;
      color: var(--deep-black);
      padding: 5px 10px;
      display: flex;
      align-items: center;
      justify-content: center;
      cursor: pointer;
    }
    
    .profile-menu {
      position: absolute;
      top: 100%;
      right: 0;
      width: 350px;
      background: linear-gradient(135deg, var(--cream-peach) 0%, var(--off-white) 100%);
      border-radius: 0 0 16px 16px;
      box-shadow: 0 10px 30px rgba(0,0,0,0.1);
      z-index: 1000;
      display: none;
      overflow: hidden;
      margin-top: 10px;
    }
    
    .profile-menu.show {
      display: block;
      animation: slideDown 0.3s ease forwards;
    }
    
    @keyframes slideDown {
      from {
        opacity: 0;
        transform: translateY(-20px);
      }
      to {
        opacity: 1;
        transform: translateY(0);
      }
    }
    
    .profile-menu-header {
      padding: 20px;
      border-bottom: 1px solid rgba(0,0,0,0.05);
      display: flex;
      align-items: center;
      justify-content: space-between;
    }
    
    .profile-menu-title {
      font-family: 'Montserrat', sans-serif;
      font-weight: 700;
      color: var(--deep-black);
      display: flex;
      align-items: center;
      gap: 10px;
      margin: 0;
    }
    
    .profile-menu-logo {
      width: 100px;
      height: 24px;
    }
    
    .close-menu {
      background: none;
      border: none;
      font-size: 1.5rem;
      color: var(--gray-medium);
      cursor: pointer;
      padding: 5px;
    }
    
    .user-info-item {
      padding: 15px 20px;
      border-bottom: 1px solid rgba(0,0,0,0.05);
      display: flex;
      justify-content: space-between;
      align-items: center;
      transition: background-color 0.2s ease;
    }
    
    .user-info-item:hover {
      background-color: rgba(247, 89, 78, 0.05);
    }
    
    .user-info-label {
      font-size: 0.9rem;
      color: var(--gray-medium);
      margin-bottom: 0;
    }
    
    .user-info-value {
      font-weight: 600;
      font-size: 1.1rem;
      color: var(--deep-black);
      margin-bottom: 0;
    }
    
    .profile-menu-footer {
      padding: 25px 20px;
      text-align: center;
      border-top: 1px solid rgba(0,0,0,0.1);
      background-color: rgba(247, 89, 78, 0.05);
    }
    
    .profile-title {
      font-size: 1.2rem;
      font-weight: 600;
      color: var(--brand-coral);
      margin-bottom: 0;
    }
    
    .menu-overlay {
      position: fixed;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background: transparent;
      z-index: 999;
      display: none;
    }
    
    
    
    /* Main Content Area - Adjust for Fixed Navbars */
    .main-content {
      margin-top: 90px;
      margin-bottom: 30px;
      min-height: calc(100vh - 150px);
    }
    
    .container-custom {
      max-width: 1200px;
      margin: 0 auto;
      padding: 0 20px;
    }
    
    /* Total Balance Card - Premium Style */
    .balance-card {
      background: linear-gradient(135deg, var(--cream-peach) 0%, var(--pure-white) 100%);
      border-radius: 24px;
      padding: 28px;
      margin-bottom: 30px;
      box-shadow: var(--card-shadow);
      border: 1px solid rgba(255,255,255,0.3);
      position: relative;
      overflow: hidden;
    }
    
    .balance-card::before {
      content: '';
      position: absolute;
      top: -50%;
      right: -50%;
      width: 200px;
      height: 200px;
      background: radial-gradient(circle, rgba(105,215,222,0.1) 0%, rgba(249,220,183,0.05) 70%);
      border-radius: 50%;
    }
    
    .balance-label {
      font-size: 0.95rem;
      color: var(--gray-medium);
      letter-spacing: 0.5px;
      margin-bottom: 8px;
      display: flex;
      align-items: center;
      gap: 8px;
    }
    
    .balance-label i {
      color: var(--brand-coral);
    }
    
    .balance-amount {
      font-size: 2.8rem;
      font-weight: 700;
      font-family: 'Montserrat', sans-serif;
      color: var(--deep-black);
      line-height: 1.2;
      margin-bottom: 5px;
    }
    
    .balance-amount span {
      font-size: 1.2rem;
      font-weight: 500;
      color: var(--gray-medium);
      margin-left: 8px;
    }
    
    .balance-note {
      font-size: 0.9rem;
      color: var(--gray-medium);
      display: flex;
      justify-content: space-between;
      align-items: center;
    }
    
    /* Brands Marquee - Different from Home Page */
    .brands-marquee-section {
      background: var(--pure-white);
      border-radius: 20px;
      padding: 20px 0;
      margin-bottom: 30px;
      box-shadow: var(--card-shadow);
      overflow: hidden;
    }
    
    .brands-marquee-header {
      display: flex;
      align-items: center;
      justify-content: space-between;
      padding: 0 20px 15px;
      border-bottom: 1px solid var(--gray-light);
    }
    
    .brands-marquee-title {
      font-weight: 600;
      color: var(--deep-black);
      margin: 0;
    }
    
    .brands-marquee-title i {
      color: var(--brand-coral);
      margin-right: 8px;
    }
    
    .brands-tag {
      background: var(--cream-peach);
      color: var(--brand-coral);
      padding: 4px 12px;
      border-radius: 30px;
      font-size: 0.8rem;
      font-weight: 600;
    }
    
    .marquee-wrapper {
      position: relative;
      width: 100%;
      overflow: hidden;
      padding: 15px 0;
    }
    
    .marquee-content {
      display: flex;
      animation: marqueeScroll 30s linear infinite;
      white-space: nowrap;
    }
    
    .marquee-content:hover {
      animation-play-state: paused;
    }
    
    @keyframes marqueeScroll {
      0% { transform: translateX(0); }
      100% { transform: translateX(-50%); }
    }
    
    .brand-item {
      display: inline-flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      margin: 0 25px;
      min-width: 120px;
    }
    
    .brand-icon {
      width: 60px;
      height: 60px;
      background: var(--off-white);
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      margin-bottom: 8px;
      box-shadow: 0 2px 8px rgba(0,0,0,0.05);
    }
    
    .brand-icon i {
      font-size: 2rem;
      color: var(--deep-black);
    }
    
    .brand-name {
      font-size: 0.85rem;
      font-weight: 600;
      color: var(--deep-black);
    }
    
    .brand-category {
      font-size: 0.7rem;
      color: var(--gray-medium);
    }
    
    /* Commission Card - Left Side Layout */
    .commission-section {
      display: flex;
      flex-wrap: wrap;
      gap: 30px;
      margin-bottom: 30px;
    }
    
    .commission-card {
      flex: 1;
      min-width: 280px;
      background: var(--pure-white);
      border-radius: 20px;
      padding: 28px;
      box-shadow: var(--card-shadow);
      position: relative;
      border: 1px solid rgba(0,0,0,0.02);
    }
    
    .commission-icon {
      width: 48px;
      height: 48px;
      background: rgba(247, 89, 78, 0.1);
      border-radius: 16px;
      display: flex;
      align-items: center;
      justify-content: center;
      margin-bottom: 20px;
    }
    
    .commission-icon i {
      font-size: 1.8rem;
      color: var(--brand-coral);
    }
    
    .commission-label {
      font-size: 0.95rem;
      color: var(--gray-medium);
      margin-bottom: 8px;
    }
    
    .commission-amount {
      font-size: 2.5rem;
      font-weight: 700;
      font-family: 'Montserrat', sans-serif;
      color: var(--deep-black);
      margin-bottom: 15px;
    }
    
    .commission-amount span {
      font-size: 1.2rem;
      font-weight: 500;
      color: var(--gray-medium);
    }
    
    .commission-note {
      font-size: 0.85rem;
      color: var(--gray-medium);
      background: var(--cream-peach);
      padding: 8px 16px;
      border-radius: 30px;
      display: inline-block;
    }
    
    .commission-note i {
      margin-right: 6px;
      color: var(--brand-coral);
    }
    
    /* Promotion Button - Custom Start Button */
    .optimization-wrapper {
      flex: 1;
      min-width: 280px;
      background: linear-gradient(135deg, var(--cream-peach), var(--pure-white));
      border-radius: 20px;
      padding: 28px;
      box-shadow: var(--card-shadow);
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      text-align: center;
    }
    
    .optimization-title {
      font-size: 1.1rem;
      font-weight: 600;
      color: var(--deep-black);
      margin-bottom: 20px;
      display: flex;
      align-items: center;
      gap: 10px;
    }
    
    .optimization-count-badge {
      background: var(--deep-black);
      color: var(--pure-white);
      padding: 5px 15px;
      border-radius: 30px;
      font-size: 0.85rem;
    }
    
    .optimize-button {
      width: 180px;
      height: 180px;
      background: linear-gradient(145deg, var(--brand-coral), #e04a40);
      border-radius: 50%;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      border: none;
      box-shadow: 0 15px 30px rgba(247, 89, 78, 0.3);
      cursor: pointer;
      transition: all 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275);
      margin-bottom: 15px;
      animation: pulseGlow 2.5s infinite;
    }
    
    @keyframes pulseGlow {
      0% {
        box-shadow: 0 5px 20px rgba(247, 89, 78, 0.3);
        transform: scale(1);
      }
      50% {
        box-shadow: 0 15px 40px rgba(247, 89, 78, 0.5);
        transform: scale(1.05);
      }
      100% {
        box-shadow: 0 5px 20px rgba(247, 89, 78, 0.3);
        transform: scale(1);
      }
    }
    
    .optimize-button:active {
      transform: scale(0.95);
      box-shadow: 0 5px 15px rgba(247, 89, 78, 0.5);
    }
    
    .optimize-button i {
      font-size: 3rem;
      color: white;
      margin-bottom: 10px;
    }
    
    .optimize-button span {
      font-size: 1.5rem;
      font-weight: 700;
      color: white;
      text-transform: uppercase;
      letter-spacing: 2px;
    }
    
    .optimization-footer {
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 20px;
      margin-top: 15px;
    }
    
    .optimization-count-display {
      font-size: 1.2rem;
      font-weight: 700;
      color: var(--deep-black);
    }
    
    .optimization-count-display span {
      color: var(--brand-coral);
      font-size: 1.4rem;
      margin: 0 2px;
    }
    
    .optimization-limit {
      font-size: 0.85rem;
      color: var(--gray-medium);
      background: var(--off-white);
      padding: 5px 12px;
      border-radius: 30px;
    }
    
    /* History Button */
    .history-section {
      margin-bottom: 30px;
    }
    
    .history-button {
      width: 100%;
      background: var(--pure-white);
      border: 1px solid var(--gray-light);
      border-radius: 16px;
      padding: 20px;
      display: flex;
      align-items: center;
      justify-content: space-between;
      transition: all 0.3s ease;
      cursor: pointer;
      box-shadow: var(--card-shadow);
    }
    
    .history-button:hover {
      border-color: var(--brand-coral);
      background: var(--cream-peach);
      transform: translateY(-2px);
    }
    
    .history-button-left {
      display: flex;
      align-items: center;
      gap: 16px;
    }
    
    .history-icon {
      width: 48px;
      height: 48px;
      background: rgba(247, 89, 78, 0.1);
      border-radius: 12px;
      display: flex;
      align-items: center;
      justify-content: center;
    }
    
    .history-icon i {
      font-size: 1.8rem;
      color: var(--brand-coral);
    }
    
    .history-info h6 {
      font-size: 1.1rem;
      font-weight: 600;
      color: var(--deep-black);
      margin-bottom: 4px;
    }
    
    .history-info p {
      font-size: 0.85rem;
      color: var(--gray-medium);
      margin-bottom: 0;
    }
    
    .history-badge {
      background: var(--brand-coral);
      color: white;
      padding: 4px 12px;
      border-radius: 30px;
      font-size: 0.75rem;
      font-weight: 600;
    }
    
    .history-arrow {
      color: var(--gray-medium);
      font-size: 1.2rem;
    }
    
    .history-button:hover .history-arrow {
      color: var(--brand-coral);
      transform: translateX(5px);
    }
    
     /* History Modal Custom Styles */
  /* History Modal Custom Styles */
  .history-modal .modal-xl {
    max-width: 1200px;
  }
  
  .history-modal .modal-content {
    border-radius: 20px;
    border: none;
    box-shadow: 0 20px 40px rgba(0,0,0,0.2);
    background: linear-gradient(135deg, var(--cream-peach) 0%, var(--off-white) 100%);
  }
  
  .history-modal .modal-header {
    background: linear-gradient(135deg, var(--cream-peach), var(--warm-beige));
    border-bottom: 1px solid rgba(0,0,0,0.05);
    padding: 20px 25px;
  }
  
  .history-modal .modal-title {
    font-weight: 700;
    color: var(--deep-black);
    font-size: 1.4rem;
  }
  
  .history-modal .modal-body {
    max-height: 70vh;
    overflow-y: auto;
    padding: 25px;
  }
  
  .history-modal .nav-tabs {
    border-bottom: 1px solid rgba(0,0,0,0.1);
    gap: 20px;
  }
  
  .history-modal .nav-tabs .nav-link {
    color: var(--gray-medium);
    font-weight: 600;
    border: none;
    padding: 10px 25px;
    border-radius: 30px;
    background: transparent;
    transition: all 0.3s ease;
  }
  
  .history-modal .nav-tabs .nav-link:hover {
    color: var(--brand-coral);
    background: rgba(247, 89, 78, 0.05);
  }
  
  .history-modal .nav-tabs .nav-link.active {
    color: white;
    background: var(--brand-coral);
    border: none;
  }
  
  /* History Cards - Similar to optimization page */
  .history-card {
    background: white;
    border-radius: 16px;
    padding: 20px;
    position: relative;
    box-shadow: 0 4px 12px rgba(0,0,0,0.05);
    border: 1px solid rgba(0,0,0,0.02);
    transition: all 0.3s ease;
    height: 100%;
  }
  
  .history-card:hover {
    transform: translateY(-3px);
    box-shadow: 0 8px 20px rgba(247, 89, 78, 0.1);
  }
  
  .history-card .status-badge {
    position: absolute;
    top: 15px;
    right: 15px;
    padding: 6px 15px;
    border-radius: 30px;
    font-size: 0.75rem;
    font-weight: 600;
    text-transform: uppercase;
    letter-spacing: 0.5px;
  }
  
  .history-card .status-completed {
    margin-top: 25px;
    background: rgba(40, 167, 69, 0.1);
    color: #28a745;
    z-index: 2;
  }
  
  .history-card .status-pending {
       margin-top: 25px;
    background: rgba(255, 193, 7, 0.1);
    color: #ffc107;
  }
  
  .history-card .status-frozen {
       margin-top: 25px;
    background: rgba(108, 117, 125, 0.1);
    color: #6c757d;
  }
  
  .history-card .card-image {
    width: 70px;
    height: 70px;
    object-fit: cover;
    border-radius: 12px;
    margin-right: 15px;
    border: 2px solid var(--brand-coral);
  }
  
  .history-card .amount-text {
    color: var(--brand-coral);
    font-weight: 700;
  }
  
  .history-card .card-footer-stats {
    display: flex;
    justify-content: space-between;
    margin-top: 15px;
    padding-top: 15px;
    border-top: 1px solid rgba(0,0,0,0.05);
  }
  
  .history-card .stat-item {
    text-align: center;
    flex: 1;
  }
  
  .history-card .stat-label {
    font-size: 0.7rem;
    color: var(--gray-medium);
    margin-bottom: 5px;
  }
  
  .history-card .stat-value {
    font-weight: 700;
    color: var(--deep-black);
  }
  
  .history-card .submit-btn-inline {
    background: var(--brand-coral);
    color: white;
    border: none;
    padding: 8px 20px;
    border-radius: 30px;
    font-size: 0.85rem;
    font-weight: 600;
    transition: all 0.3s ease;
  }
  
  .history-card .submit-btn-inline:hover {
    background: #e04a40;
    transform: translateY(-2px);
    box-shadow: 0 5px 15px rgba(247, 89, 78, 0.3);
  }
  
  #history-submit-all-button {
    background: var(--brand-coral);
    border: none;
    border-radius: 50px;
    padding: 12px 30px;
    font-weight: 600;
    transition: all 0.3s ease;
    box-shadow: 0 5px 15px rgba(247, 89, 78, 0.2);
  }
  
  #history-submit-all-button:hover {
    background: #e04a40;
    transform: translateY(-2px);
    box-shadow: 0 8px 25px rgba(247, 89, 78, 0.4);
  }
  
  #historyMessageOverlay {
    position: sticky;
    top: 0;
    z-index: 1050;
    border-radius: 10px;
    animation: slideDown 0.3s ease;
  }
  
  @keyframes slideDown {
    from {
      opacity: 0;
      transform: translateY(-20px);
    }
    to {
      opacity: 1;
      transform: translateY(0);
    }
  }
  
  @media (max-width: 768px) {
    .history-modal .modal-body {
      padding: 15px;
    }
    
    .history-card {
      padding: 15px;
    }
    
    .history-card .card-image {
      width: 50px;
      height: 50px;
    }
    
    .history-card h6 {
      font-size: 0.9rem;
    }
    
    .history-card .stat-label {
      font-size: 0.6rem;
    }
    
    .history-card .stat-value {
      font-size: 0.8rem;
    }
  }
    
    /* Notes Section */
    .notes-section {
      background: var(--pure-white);
      border-radius: 20px;
      padding: 25px;
      margin-top: 10px;
      margin-bottom: 20px;
      box-shadow: var(--card-shadow);
      border-left: 5px solid var(--brand-coral);
    }
    
    .notes-title {
      font-size: 1.1rem;
      font-weight: 700;
      color: var(--deep-black);
      margin-bottom: 12px;
      display: flex;
      align-items: center;
      gap: 8px;
    }
    
    .notes-title i {
      color: var(--brand-coral);
    }
    
    .notes-text {
      color: var(--gray-medium);
      font-size: 0.95rem;
      line-height: 1.6;
    }
    
    /* Task Modal - Matching Home Page Style */
    .modal-content {
      border-radius: 20px;
      border: none;
      box-shadow: 0 20px 40px rgba(0,0,0,0.2);
      overflow: hidden;
    }
    
    .modal-header {
      background: linear-gradient(135deg, var(--cream-peach), var(--warm-beige));
      border-bottom: none;
      padding: 20px;
    }
    
    .modal-title {
      font-weight: 700;
      color: var(--deep-black);
    }
    
    .modal-body {
      padding: 25px;
    }
    
    .selected-image {
      width: 100px;
      height: 100px;
      object-fit: cover;
      border-radius: 12px;
      border: 2px solid var(--brand-coral);
    }
    
    .usdc-amount {
      font-weight: 700;
      color: var(--brand-coral);
    }
    
    .text-blue {
      color: var(--brand-coral);
      font-weight: 600;
    }
    
    .btn-danger {
      background-color: var(--brand-coral);
      border: none;
      border-radius: 50px;
      padding: 12px;
      color: white;
      font-weight: 600;
      transition: all 0.3s ease;
    }
    
    .btn-danger:hover {
      background-color: #e04a40;
      transform: translateY(-2px);
    }
    
    
  /* Loader Overlay - Full page but non-intrusive */
.loader-overlay {
  position: fixed;
  top: 0;
  left: 0;
  width: 100%;
  height: 100%;
  background-color: rgba(27, 27, 27, 0.7);
  backdrop-filter: blur(5px);
  -webkit-backdrop-filter: blur(5px);
  display: none;
  justify-content: center;
  align-items: center;
  z-index: 9999;
}

.loader-overlay.show {
  display: flex;
}

.loader-container {
  background: var(--pure-white);
  border-radius: 20px;
  padding: 30px 40px;
  text-align: center;
  box-shadow: 0 20px 40px rgba(0,0,0,0.2);
  animation: scaleIn 0.3s ease;
}

@keyframes scaleIn {
  from {
    transform: scale(0.8);
    opacity: 0;
  }
  to {
    transform: scale(1);
    opacity: 1;
  }
}

.loader-spinner {
  width: 60px;
  height: 60px;
  border: 5px solid var(--cream-peach);
  border-top: 5px solid var(--brand-coral);
  border-radius: 50%;
  animation: spin 1s linear infinite;
  margin: 0 auto 15px;
}

.loader-text {
  font-size: 1rem;
  color: var(--deep-black);
  font-weight: 500;
  margin-top: 10px;
}

.loader-text small {
  font-size: 0.85rem;
  color: var(--gray-medium);
  display: block;
  margin-top: 5px;
}

@keyframes spin {
  0% { transform: rotate(0deg); }
  100% { transform: rotate(360deg); }
}

/* Error Message Overlay - Centered */
.error-overlay {
  position: fixed;
  top: 50%;
  left: 50%;
  transform: translate(-50%, -50%);
  min-width: 320px;
  max-width: 400px;
  background: rgba(255, 255, 255, 0.98);
  backdrop-filter: blur(10px);
  -webkit-backdrop-filter: blur(10px);
  border-radius: 16px;
  padding: 24px;
  box-shadow: 0 20px 40px rgba(247, 89, 78, 0.3);
  border-left: 5px solid var(--brand-coral);
  z-index: 10000;
  display: none;
  animation: fadeInScale 0.3s ease;
}

.error-overlay.show {
  display: block;
}

@keyframes fadeInScale {
  from {
    opacity: 0;
    transform: translate(-50%, -40%);
  }
  to {
    opacity: 1;
    transform: translate(-50%, -50%);
  }
}

.error-content {
  display: flex;
  align-items: flex-start;
  gap: 15px;
}

.error-icon {
  width: 48px;
  height: 48px;
  background: rgba(247, 89, 78, 0.1);
  border-radius: 50%;
  display: flex;
  align-items: center;
  justify-content: center;
  flex-shrink: 0;
}

.error-icon i {
  font-size: 1.8rem;
  color: var(--brand-coral);
}

.error-message {
  flex: 1;
  font-size: 1rem;
  color: var(--deep-black);
  font-weight: 500;
  line-height: 1.5;
  padding-top: 5px;
}

.error-close {
  background: none;
  border: none;
  color: var(--gray-medium);
  font-size: 1.2rem;
  cursor: pointer;
  padding: 5px;
  transition: color 0.3s ease;
  flex-shrink: 0;
  position: absolute;
  top: 15px;
  right: 15px;
}

.error-close:hover {
  color: var(--brand-coral);
}

/* Hide the old full-page loader/overlay */
.overlay {
  display: none !important;
}
    /* Responsive Adjustments */
    @media (max-width: 992px) {
      .container-custom {
        padding: 0 15px;
      }
      
      .balance-amount {
        font-size: 2.2rem;
      }
      
      .commission-amount {
        font-size: 2rem;
      }
      
      .optimize-button {
        width: 150px;
        height: 150px;
      }
      
      .optimize-button i {
        font-size: 2.5rem;
      }
      
      .optimize-button span {
        font-size: 1.2rem;
      }
    }
    
    @media (max-width: 768px) {
      .navbar {
        height: 60px;
        padding: 10px 0;
      }
      
      .evertune-logo {
        width: 100px;
        height: 24px;
      }
      
      .main-content {
        margin-top: 80px;
      }
      
      .profile-menu {
        width: 300px;
      }
      
      .balance-card {
        padding: 20px;
      }
      
      .balance-amount {
        font-size: 1.8rem;
      }
      
      .commission-section {
        flex-direction: column;
      }
      
      .commission-card, .optimization-wrapper {
        width: 100%;
      }
      
      .brand-item {
        min-width: 100px;
        margin: 0 15px;
      }
      
      .brand-icon {
        width: 50px;
        height: 50px;
      }
      
      .brand-icon i {
        font-size: 1.6rem;
      }
      
       }
    
    @media (max-width: 480px) {
      .balance-amount {
        font-size: 1.6rem;
      }
      
      .commission-amount {
        font-size: 1.8rem;
      }
      
      .optimize-button {
        width: 130px;
        height: 130px;
      }
      
      .optimize-button i {
        font-size: 2rem;
      }
      
      .optimize-button span {
        font-size: 1rem;
      }
      
      .profile-menu {
        width: 280px;
      }
      
      .history-info h6 {
        font-size: 1rem;
      }
      
      .history-info p {
        font-size: 0.8rem;
      }
    }
      /* Footer Links */
        .footer-links {
            padding: 40px 0;
            background-color: var(--pure-white);
            border-top: 1px solid rgba(0,0,0,0.05);
        }
        
        .footer-link-item {
            display: block;
            text-align: center;
            padding: 10px 0;
            color: var(--gray-medium);
            text-decoration: none;
            transition: color 0.3s ease;
        }
        
        .footer-link-item:hover {
            color: var(--brand-coral);
        }
        
  /* ============================================
   PROFILE MODAL - RESPONSIVE CSS
   ============================================ */

.profile-modal {
  position: fixed;
  top: 0;
  left: 0;
  width: 100%;
  height: 100%;
  display: flex;
  align-items: flex-start;
  justify-content: center;
  z-index: 1032;
  visibility: hidden;
  opacity: 0;
  transition: visibility 0.3s, opacity 0.3s;
  padding-top: 70px;
  overflow-y: auto;
}

.profile-modal.show {
  visibility: visible;
  opacity: 1;
}

.profile-modal-content {
  background: var(--pure-white);
  border-radius: 0 0 20px 20px;
  box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
  width: 100%;
  max-width: 900px;
  max-height: calc(100vh - 70px);
  overflow-y: auto;
  transform: translateY(-100%);
  transition: transform 0.4s ease;
  position: relative;
}

.profile-modal.show .profile-modal-content {
  transform: translateY(0);
}

.profile-modal-header {
  padding: 20px 25px;
  background: linear-gradient(135deg, var(--cream-peach) 0%, var(--warm-beige) 100%);
  border-radius: 0 0 20px 20px;
  display: flex;
  align-items: center;
  justify-content: space-between;
  position: sticky;
  top: 0;
  z-index: 10;
}

.profile-modal-header .evertune-logo {
  width: 130px;
  height: 30px;
}

.profile-modal-close {
  background: none;
  border: none;
  font-size: 1.8rem;
  color: var(--deep-black);
  cursor: pointer;
  width: 40px;
  height: 40px;
  display: flex;
  align-items: center;
  justify-content: center;
  border-radius: 50%;
  transition: all 0.3s ease;
  flex-shrink: 0;
}

.profile-modal-close:hover {
  background-color: rgba(27, 27, 27, 0.1);
  transform: rotate(90deg);
}

.profile-modal-body {
  padding: 25px;
}

/* User Info Grid */
.user-info-grid {
  display: grid;
  grid-template-columns: repeat(3, 1fr);
  gap: 15px;
  margin-bottom: 25px;
  padding-bottom: 25px;
  border-bottom: 1px solid rgba(0,0,0,0.1);
}

.info-card {
  background: linear-gradient(135deg, var(--cream-peach) 0%, var(--off-white) 100%);
  border-radius: 12px;
  padding: 15px 12px;
  text-align: center;
  box-shadow: var(--card-shadow);
}

.info-label {
  font-size: 0.8rem;
  color: var(--gray-medium);
  margin-bottom: 6px;
  line-height: 1.3;
}

.info-value {
  font-size: 1.1rem;
  font-weight: 700;
  color: var(--deep-black);
  word-break: break-all;
}

/* Profile Links Section */
.profile-links-section {
  margin-bottom: 20px;
}

.profile-section-title {
  font-size: 1.1rem;
  font-weight: 600;
  color: var(--brand-coral);
  margin-bottom: 15px;
  padding-left: 10px;
  border-left: 4px solid var(--brand-coral);
  cursor: pointer;
  display: flex;
  align-items: center;
  gap: 10px;
  transition: color 0.3s ease;
}

.profile-section-title:hover {
  color: #e04a40;
}

.profile-section-title i {
  font-size: 1rem;
  transition: transform 0.3s ease;
}

.profile-section-title.active i {
  transform: rotate(180deg);
}

.profile-links-grid {
  display: grid;
  grid-template-columns: repeat(4, 1fr);
  gap: 12px;
  max-height: 0;
  overflow: hidden;
  transition: max-height 0.5s ease;
}

.profile-links-grid.show {
  max-height: 600px;
}

.profile-link-item {
  background: var(--off-white);
  border: 1px solid rgba(0,0,0,0.05);
  border-radius: 10px;
  padding: 14px 10px;
  text-align: center;
  text-decoration: none;
  color: var(--deep-black);
  font-weight: 500;
  font-size: 0.85rem;
  transition: all 0.3s ease;
  display: flex;
  flex-direction: column;
  align-items: center;
  gap: 8px;
}

.profile-link-item i {
  font-size: 1.4rem;
  color: var(--brand-coral);
}

.profile-link-item:hover {
  background: var(--brand-coral);
  color: var(--pure-white);
  transform: translateY(-4px);
  box-shadow: 0 8px 16px rgba(247, 89, 78, 0.3);
}

.profile-link-item:hover i {
  color: var(--pure-white);
}

.profile-link-item.logout {
  background: rgba(247, 89, 78, 0.1);
  border-color: var(--brand-coral);
}

.profile-link-item.logout:hover {
  background: var(--brand-coral);
}

/* Profile Overlay */
.profile-overlay {
  position: fixed;
  top: 0;
  left: 0;
  width: 100%;
  height: 100%;
  backdrop-filter: blur(8px);
  -webkit-backdrop-filter: blur(8px);
  background-color: rgba(0, 0, 0, 0.3);
  z-index: 1031;
  display: none;
}

.profile-overlay.show {
  display: block;
}

/* ============================================
   RESPONSIVE BREAKPOINTS
   ============================================ */

/* Large tablets (992px and below) */
@media (max-width: 992px) {
  .profile-links-grid {
    grid-template-columns: repeat(3, 1fr);
  }

  .user-info-grid {
    grid-template-columns: repeat(3, 1fr);
  }
}

/* Tablets (768px and below) */
@media (max-width: 768px) {
  .profile-modal {
    padding-top: 60px;
    align-items: flex-start;
  }

  .profile-modal-content {
    max-width: 100%;
    border-radius: 0 0 16px 16px;
    max-height: calc(100vh - 60px);
  }

  .profile-modal-header {
    padding: 14px 18px;
  }

  .profile-modal-header .evertune-logo {
    width: 110px;
    height: 26px;
  }

  .profile-modal-close {
    font-size: 1.5rem;
    width: 36px;
    height: 36px;
  }

  .profile-modal-body {
    padding: 18px;
  }

  .user-info-grid {
    grid-template-columns: repeat(2, 1fr);
    gap: 12px;
    margin-bottom: 20px;
    padding-bottom: 20px;
  }

  .info-card {
    padding: 14px 10px;
  }

  .info-label {
    font-size: 0.75rem;
  }

  .info-value {
    font-size: 1rem;
  }

  .profile-links-grid {
    grid-template-columns: repeat(3, 1fr);
    gap: 10px;
  }

  .profile-link-item {
    padding: 12px 8px;
    font-size: 0.78rem;
    gap: 6px;
  }

  .profile-link-item i {
    font-size: 1.3rem;
  }
}

/* Small phones (576px and below) */
@media (max-width: 576px) {
  .profile-modal {
    padding-top: 60px;
  }

  .profile-modal-body {
    padding: 14px;
  }

  .profile-modal-header {
    padding: 12px 14px;
  }

  .profile-modal-header .evertune-logo {
    width: 95px;
    height: 22px;
  }

  .user-info-grid {
    grid-template-columns: repeat(2, 1fr);
    gap: 10px;
  }

  .info-card {
    padding: 12px 8px;
    border-radius: 10px;
  }

  .info-label {
    font-size: 0.7rem;
    margin-bottom: 4px;
  }

  .info-value {
    font-size: 0.9rem;
  }

  .profile-section-title {
    font-size: 1rem;
    margin-bottom: 12px;
  }

  .profile-links-grid {
    grid-template-columns: repeat(2, 1fr);
    gap: 10px;
  }

  .profile-link-item {
    padding: 14px 8px;
    font-size: 0.8rem;
    border-radius: 10px;
  }

  .profile-link-item i {
    font-size: 1.4rem;
  }
}

/* Extra small phones (400px and below) */
@media (max-width: 400px) {
  .user-info-grid {
    grid-template-columns: 1fr 1fr;
    gap: 8px;
  }

  .info-value {
    font-size: 0.85rem;
  }

  .profile-links-grid {
    grid-template-columns: repeat(2, 1fr);
    gap: 8px;
  }

  .profile-link-item {
    padding: 12px 6px;
    font-size: 0.75rem;
  }

  .profile-link-item i {
    font-size: 1.25rem;
  }

  .profile-modal-header .evertune-logo {
    width: 85px;
    height: 20px;
  }
}
  </style>
</head>
<body>
  <!-- Top Navbar - Matching Home Page -->
  <nav class="navbar">
    <div class="navbar-container">
      <!-- Left: Logo - Link to Home Page -->
      <div class="navbar-left">
        <div class="logo-wrapper">
          <a href="/home" style="display: flex; align-items: center;">
            <svg class="evertune-logo" viewBox="0 0 136 32" fill="none" xmlns="http://www.w3.org/2000/svg">
              <path d="M0.132268 29.32C-0.16107 28.0008 0.0842353 26.7314 0.375858 25.51C0.864755 23.2148 1.69502 21.0173 2.47554 18.8182L3.11025 17.0598C2.71913 16.9621 2.32801 16.914 1.98664 16.7665C1.25416 16.3754 1.20441 15.4473 1.93861 15.0082C2.47554 14.7149 3.06222 14.5193 3.64718 14.3237C4.08633 14.1779 4.37967 13.9824 4.57523 13.5415L7.50518 7.1927C7.60296 7.04689 7.65099 6.85134 7.45714 6.70381C7.35936 6.65578 7.11578 6.60603 6.96825 6.65578C5.89439 7.0469 4.67301 7.14467 3.69521 7.87716C3.5494 7.97494 3.25606 8.02297 3.01076 8.02297C2.52186 8.02297 2.18049 7.77938 1.98493 7.38826C1.83912 6.99715 1.9369 6.50997 2.22852 6.16688C2.71742 5.67798 3.35213 5.43439 3.98683 5.23883C5.35403 4.79968 6.6732 4.36053 8.04039 4.01745C8.62707 3.87164 9.11425 3.72411 9.35956 3.13915C9.65289 2.50444 10.1898 2.30888 10.7268 2.60222C11.7028 3.09112 12.5828 2.84581 13.5589 2.60222L23.1808 0.159447C23.5221 0.0616675 23.8652 -0.0841399 24.2546 0.0616715C24.6457 0.25723 25.0849 0.452788 25.1329 0.93997C25.1809 1.42715 24.7915 1.67246 24.3507 1.81827C23.7160 2.06186 23.1293 2.30716 22.4466 2.50272C19.3210 3.33299 16.1955 4.16326 13.0683 5.04327L11.9945 5.33661C11.6531 5.43439 11.3597 5.67798 11.2122 6.02107L8.38004 12.713C9.01475 12.9565 9.40587 12.761 9.84502 12.6649C12.1403 12.0782 14.4853 11.5413 16.7805 10.9564C17.4152 10.7608 18.0019 10.8105 18.5388 11.1519C18.9780 11.4933 18.978 12.08 18.5388 12.4213C18.1477 12.6649 17.7566 12.7627 17.3174 12.8605C14.3875 13.6907 11.4558 14.5708 8.47783 15.3032C7.50175 15.5468 6.86532 15.9877 6.52395 16.9638C5.35232 20.2849 4.08118 23.5081 3.34869 26.927C3.20288 27.5617 3.10511 28.1484 3.20288 28.7831C3.25092 29.1742 3.49622 29.4178 3.93537 29.4178C4.86342 29.4178 5.74172 29.1245 6.66976 28.8809C9.25834 28.1964 11.7491 27.2203 14.0941 25.8034C14.7288 25.4123 15.3636 25.1189 16.1938 25.3145C16.5352 25.4123 16.8783 25.6078 17.0241 25.9492C17.2196 26.4381 16.9761 26.7795 16.6330 27.1208C16.4374 27.3164 16.1441 27.4622 15.9005 27.6578C12.8230 29.7574 9.40416 31.1246 5.78975 31.8588C4.95948 32.0544 4.08118 32.0047 3.20117 31.9566C1.54063 31.8588 0.514808 30.9805 0.12369 29.32H0.132268Z" fill="#F7594E"/>
              <path d="M21.0365 26.8292C21.0846 26.2923 21.1343 25.7056 21.2321 25.1687C21.9646 21.652 23.1362 18.2332 24.1621 14.7663C24.4057 13.9841 24.6012 13.2036 24.8465 12.4711C24.9923 11.8844 25.4332 11.6408 25.9204 11.6888C26.5071 11.7369 26.8965 12.0302 26.9942 12.5671C27.0920 13.2018 27.3853 13.8365 26.8484 14.4713C26.6048 14.7646 26.5071 15.2535 26.4093 15.6429C25.9701 17.1079 25.5310 18.6226 25.1879 20.0876C24.6012 22.3828 25.7248 20.6245 25.9204 20.3312C27.7765 17.6448 29.5348 14.8607 31.4887 12.3218C31.7322 12.0285 31.9776 11.7351 32.1731 11.4435C32.5642 10.9066 33.0514 10.8088 33.6381 10.9066C34.4684 11.0524 34.7617 11.6391 34.3706 12.3716C34.2728 12.5671 34.1270 12.7627 33.9795 12.9582C31.1473 17.1096 28.4609 21.4084 25.8226 25.6576C25.4812 26.1945 25.1381 26.6834 24.7968 27.1723C24.5532 27.5136 24.2598 27.8567 23.9185 28.1484C23.3815 28.6373 22.6971 28.6853 22.0143 28.4417C21.3299 28.1981 20.9885 27.5634 21.0383 26.8292H21.0365Z" fill="#F7594E"/>
              <path d="M35.1022 26.0968C34.5653 25.4621 33.8808 24.1429 34.4177 22.2388C35.4436 18.7719 37.1521 15.6944 39.6927 13.1539C40.6687 12.1281 41.8421 11.3475 43.2573 10.9067C43.9898 10.6631 44.6743 10.7609 45.3570 11.1022C46.3331 11.5414 46.7242 12.2739 46.6762 13.2997C46.5784 14.178 46.1873 14.9602 45.7979 15.6927C44.3809 18.1835 42.5248 20.2832 40.3274 22.1393C39.3993 22.9215 38.3735 23.6043 37.3477 24.239C36.9085 24.4826 36.9085 24.9715 37.3477 25.2648C37.8366 25.5581 38.3238 25.7039 38.9104 25.5581C39.5451 25.4123 40.2296 25.2648 40.8643 25.0212C44.5267 23.6043 49.6061 20.4307 52.5858 17.8902C53.0747 17.4991 53.4641 17.0119 53.9050 16.571C54.4917 15.9843 55.0286 15.9363 55.7113 16.3274C56.0527 16.571 56.2483 17.0599 56.0527 17.451C55.9549 17.6466 55.8091 17.8902 55.6616 18.0857C55.0749 18.7204 54.5380 19.4049 53.9033 19.9418C50.9733 22.5304 45.9917 25.7057 42.3773 27.1706C41.4012 27.6098 40.3257 27.9529 39.0065 27.9529C37.5896 27.8551 36.1743 27.3182 35.0988 26.0968H35.1022ZM37.4952 21.3107C37.6908 21.3605 37.8863 21.213 38.0819 21.0671C40.1816 19.3088 41.9896 17.3069 43.3568 14.9619C43.6502 14.425 44.2351 13.9361 43.8938 13.1556C43.2590 13.2036 42.7701 13.5947 42.2813 13.9859C40.0340 15.842 38.5210 18.2847 37.4455 21.0191C37.3974 21.1169 37.4455 21.2147 37.4935 21.3125L37.4952 21.3107Z" fill="#F7594E"/>
              <path d="M49.5577 27.0243C49.5097 26.4874 49.6057 25.9505 49.8510 25.4118C50.4377 24.1424 50.9746 22.8232 51.5596 21.5538C52.6335 19.3066 53.7571 17.0611 54.8326 14.7641C55.2238 13.8858 55.6149 13.0058 55.6149 11.98C55.6149 11.8822 55.6629 11.7364 55.7127 11.6386C55.8585 10.9061 56.2496 10.515 56.7385 10.5648C57.5207 10.6128 58.0576 11.1017 58.1057 11.8342C58.1057 12.4209 58.0576 13.0556 57.9599 13.6405C57.9101 14.1294 57.7163 14.5188 57.5687 15.0077C57.8621 15.2033 58.0079 15.0077 58.2035 14.8122L60.1076 12.6147C61.5245 10.9542 64.1611 11.8325 64.6981 13.6405C65.0892 14.8619 65.0892 16.0833 64.8439 17.303C64.7461 17.8399 64.3550 18.1332 63.8181 18.1813C63.1336 18.1813 62.5967 17.8399 62.4509 17.2052C62.4028 16.8141 62.4028 16.4727 62.3531 16.0816L62.2073 15.2033C62.2073 15.1055 62.0615 15.0077 62.0117 14.91C61.5726 14.8619 61.3770 15.2513 61.1814 15.4966C60.3031 16.6683 59.3751 17.8416 58.5448 19.0613C57.0301 21.3565 55.5651 23.7015 54.0521 25.9968C53.6130 26.6315 53.1241 27.2662 52.6352 27.9009C52.2938 28.3898 51.7569 28.5853 51.2182 28.5853C50.1924 28.5853 49.5577 27.9987 49.5577 27.0226V27.0243ZM57.6168 15.157L57.5687 15.0112V15.0592L57.6168 15.157Z" fill="#F7594E"/>
              <path d="M64.6012 29.956C64.4057 29.4671 64.4554 28.9799 64.6012 28.491C65.0901 26.6846 66.1159 23.2658 66.6031 21.4577C66.7009 21.0666 67.6290 18.43 68.7526 15.3045C67.4334 15.4023 66.4573 15.4503 66.3595 15.4503C65.9204 15.4023 65.4812 15.4023 65.1382 15.157C64.7968 14.9134 64.5515 14.6681 64.6012 14.2787C64.6012 13.7898 64.9426 13.692 65.3337 13.644C66.2618 13.5462 67.1898 13.4484 68.1178 13.4004L69.4370 13.3026C70.8042 9.54237 72.2692 5.68265 72.8078 4.75632C73.0034 4.3652 73.1492 3.97408 73.3945 3.63271C73.8834 2.70467 74.8115 2.65664 75.4462 3.4869C75.6417 3.78024 75.6897 4.07358 75.5920 4.3652C75.4462 4.75632 75.2506 5.14744 75.1031 5.53684C74.4684 7.00181 73.7839 8.46679 73.1989 9.93177L72.0753 13.1551C73.5403 13.0573 74.8595 12.9595 75.2009 12.9595C75.8853 12.9115 76.5680 12.8617 77.2525 12.8617C77.5939 12.8617 77.9370 12.9595 78.2286 13.3009C78.4241 13.5445 78.4722 13.8378 78.2286 14.0831C77.8872 14.5223 77.4463 14.62 76.9094 14.6698L71.4389 15.1089C69.8264 19.8469 67.5809 26.5371 66.8484 28.7843C66.7507 29.1754 66.6048 29.6146 66.4573 30.0057C66.3115 30.3471 66.0182 30.5924 65.6271 30.5924C65.1382 30.5924 64.7968 30.3968 64.6012 29.9577V29.956Z" fill="#F7594E"/>
              <path d="M81.6442 26.1954C81.5464 25.7562 81.5464 25.2673 81.4487 24.7785C81.0095 24.7304 80.8140 25.1198 80.5206 25.3154C79.8362 25.8523 79.2015 26.439 78.5187 26.9279C78.0796 27.2693 77.5907 27.5146 77.0040 27.5146C75.7826 27.5626 75.0021 26.9776 74.8546 25.7562C74.7568 24.974 74.8546 24.1935 75.0982 23.4113C76.1240 20.188 77.7845 17.258 79.9339 14.6197C80.5206 13.9352 81.1553 13.6436 82.0336 13.985C82.5225 14.1308 82.7661 14.6694 82.5225 15.1566C82.2789 15.5477 82.0336 15.8411 81.7900 16.2305C80.2753 18.3799 78.9579 20.6254 78.0778 23.166C77.9801 23.4095 77.7845 23.7029 77.9801 24.0442C78.5667 23.8487 78.9562 23.3598 79.3473 22.9704C80.8122 21.5054 82.1794 20.0404 83.5964 18.6235C84.3289 17.891 84.9155 17.8413 85.7458 18.3302C86.1369 18.5738 86.3325 18.9649 86.1850 19.404C86.0392 19.7951 85.8436 20.1863 85.6961 20.5757C85.1094 21.8948 84.5725 23.31 84.2311 24.727C84.1333 25.1661 84.0355 25.5573 84.1333 25.9964C84.1813 26.2897 84.3769 26.4356 84.6222 26.4356C84.9155 26.3875 85.2089 26.2897 85.5005 26.192C86.5263 25.7528 87.4544 25.1661 88.3327 24.4834C91.4102 22.2859 94.3401 19.8432 96.9767 17.1088C97.1723 16.8652 97.3678 16.6696 97.6114 16.4243C98.0025 16.131 98.3937 16.131 98.8328 16.3265C99.4675 16.6199 99.6631 17.1088 99.2720 17.6457C98.7831 18.2804 98.2959 18.9151 97.7092 19.4521C95.2184 22.0887 92.4840 24.4337 89.5043 26.5333C88.4305 27.3156 87.2571 28.0481 85.9397 28.3894C85.5485 28.4872 85.1094 28.585 84.6702 28.585C83.0577 28.585 82.0336 27.8028 81.6425 26.192L81.6442 26.1954Z" fill="#F7594E"/>
              <path d="M92.2911 28.7353C92.4370 28.3442 92.6823 28.0028 92.8281 27.6117C93.9997 25.1689 95.1233 22.7279 96.2950 20.2851C97.3208 18.1854 97.9555 15.9382 98.1013 13.5932C98.1493 12.9585 98.1493 12.3718 98.3946 11.7869C98.6880 11.1024 99.1769 10.9086 99.8596 11.1024C100.544 11.298 100.885 11.7869 100.983 12.4216C101.129 13.1541 101.081 13.8865 100.935 14.619L100.496 16.964C100.985 17.3054 101.374 16.8662 101.765 16.8182C103.378 16.6724 104.354 17.4529 104.354 19.1135C104.402 19.8957 104.306 20.6762 104.208 21.5065C104.062 22.6301 104.013 23.8017 104.062 24.9734C104.110 25.7556 104.502 25.9992 105.136 25.6578C105.821 25.2667 106.406 24.8756 106.992 24.4364C109.727 22.5323 112.218 20.3331 114.563 17.9898C115.051 17.4529 115.588 16.964 116.125 16.4271C116.564 15.9879 117.053 15.8902 117.640 16.0857C118.568 16.3293 118.812 16.964 118.227 17.6982C117.836 18.2352 117.348 18.7721 116.908 19.261C114.417 22.0451 111.682 24.6337 108.653 26.8312C107.677 27.5637 106.651 28.1984 105.380 28.4437C103.671 28.785 101.815 28.1503 101.424 25.9031C101.278 25.0248 101.180 24.0968 101.278 23.1687C101.376 22.3385 101.424 21.4602 101.474 20.6282L101.132 20.4824C100.693 21.069 100.254 21.654 99.863 22.2407C98.3483 24.4879 96.8353 26.7334 95.3206 28.9326C95.0273 29.3717 94.7339 29.7628 94.4423 30.1539C94.0512 30.5931 93.2707 30.6909 92.7337 30.3495C92.2448 30.0562 92.0012 29.4215 92.2946 28.737L92.2911 28.7353Z" fill="#F7594E"/>
              <path d="M114.517 26.0968C113.980 25.4621 113.295 24.1429 113.832 22.2388C114.858 18.7719 116.567 15.6944 119.107 13.1539C120.083 12.1281 121.257 11.3475 122.672 10.9067C123.404 10.6631 124.089 10.7609 124.772 11.1022C125.748 11.5414 126.139 12.2739 126.091 13.2997C125.993 14.178 125.602 14.9602 125.213 15.6927C123.796 18.1835 121.94 20.2832 119.742 22.1393C118.814 22.9215 117.788 23.6043 116.762 24.239C116.323 24.4826 116.323 24.9715 116.762 25.2648C117.251 25.5581 117.738 25.7039 118.325 25.5581C118.96 25.4123 119.644 25.2648 120.279 25.0212C123.941 23.6043 129.021 20.4307 132 17.8902C132.489 17.4991 132.879 17.0119 133.32 16.571C133.906 15.9843 134.443 15.9363 135.126 16.3274C135.467 16.571 135.663 17.0599 135.467 17.451C135.37 17.6466 135.224 17.8902 135.076 18.0857C134.49 18.7204 133.953 19.4049 133.318 19.9418C130.388 22.5304 125.406 25.7057 121.792 27.1706C120.816 27.6098 119.74 27.9529 118.421 27.9529C117.004 27.8551 115.589 27.3182 114.513 26.0968H114.517ZM116.91 21.3107C117.105 21.3605 117.301 21.213 117.497 21.0671C119.596 19.3088 121.404 17.3069 122.771 14.9619C123.065 14.425 123.65 13.9361 123.308 13.1556C122.674 13.2036 122.185 13.5947 121.696 13.9859C119.449 15.842 117.936 18.2847 116.86 21.0191C116.812 21.1169 116.86 21.2147 116.908 21.3125L116.91 21.3107Z" fill="#F7594E"/>
            </svg>
          </a>
        </div>
      </div>
      
     <!-- Right: Profile Menu -->
<div class="navbar-right">
  <div class="profile-dropdown">
    <button class="hamburger-menu" id="profileMenuToggle">
      <i class="bi bi-list"></i>
    </button>
    
    <!-- Blur Overlay -->
    <div class="profile-overlay" id="profileOverlay"></div>

    <!-- Profile Modal - MATCHING HOME PAGE EXACTLY -->
    <div class="profile-modal" id="profileModal">
      <div class="profile-modal-content">
        <div class="profile-modal-header">
          <!-- Evertune Logo -->
          <svg class="evertune-logo" viewBox="0 0 136 32" fill="none" xmlns="http://www.w3.org/2000/svg">
            <path d="M0.132268 29.32C-0.16107 28.0008 0.0842353 26.7314 0.375858 25.51C0.864755 23.2148 1.69502 21.0173 2.47554 18.8182L3.11025 17.0598C2.71913 16.9621 2.32801 16.914 1.98664 16.7665C1.25416 16.3754 1.20441 15.4473 1.93861 15.0082C2.47554 14.7149 3.06222 14.5193 3.64718 14.3237C4.08633 14.1779 4.37967 13.9824 4.57523 13.5415L7.50518 7.1927C7.60296 7.04689 7.65099 6.85134 7.45714 6.70381C7.35936 6.65578 7.11578 6.60603 6.96825 6.65578C5.89439 7.0469 4.67301 7.14467 3.69521 7.87716C3.5494 7.97494 3.25606 8.02297 3.01076 8.02297C2.52186 8.02297 2.18049 7.77938 1.98493 7.38826C1.83912 6.99715 1.9369 6.50997 2.22852 6.16688C2.71742 5.67798 3.35213 5.43439 3.98683 5.23883C5.35403 4.79968 6.6732 4.36053 8.04039 4.01745C8.62707 3.87164 9.11425 3.72411 9.35956 3.13915C9.65289 2.50444 10.1898 2.30888 10.7268 2.60222C11.7028 3.09112 12.5828 2.84581 13.5589 2.60222L23.1808 0.159447C23.5221 0.0616675 23.8652 -0.0841399 24.2546 0.0616715C24.6457 0.25723 25.0849 0.452788 25.1329 0.93997C25.1809 1.42715 24.7915 1.67246 24.3507 1.81827C23.7160 2.06186 23.1293 2.30716 22.4466 2.50272C19.3210 3.33299 16.1955 4.16326 13.0683 5.04327L11.9945 5.33661C11.6531 5.43439 11.3597 5.67798 11.2122 6.02107L8.38004 12.713C9.01475 12.9565 9.40587 12.761 9.84502 12.6649C12.1403 12.0782 14.4853 11.5413 16.7805 10.9564C17.4152 10.7608 18.0019 10.8105 18.5388 11.1519C18.9780 11.4933 18.978 12.08 18.5388 12.4213C18.1477 12.6649 17.7566 12.7627 17.3174 12.8605C14.3875 13.6907 11.4558 14.5708 8.47783 15.3032C7.50175 15.5468 6.86532 15.9877 6.52395 16.9638C5.35232 20.2849 4.08118 23.5081 3.34869 26.927C3.20288 27.5617 3.10511 28.1484 3.20288 28.7831C3.25092 29.1742 3.49622 29.4178 3.93537 29.4178C4.86342 29.4178 5.74172 29.1245 6.66976 28.8809C9.25834 28.1964 11.7491 27.2203 14.0941 25.8034C14.7288 25.4123 15.3636 25.1189 16.1938 25.3145C16.5352 25.4123 16.8783 25.6078 17.0241 25.9492C17.2196 26.4381 16.9761 26.7795 16.6330 27.1208C16.4374 27.3164 16.1441 27.4622 15.9005 27.6578C12.8230 29.7574 9.40416 31.1246 5.78975 31.8588C4.95948 32.0544 4.08118 32.0047 3.20117 31.9566C1.54063 31.8588 0.514808 30.9805 0.12369 29.32H0.132268Z" fill="#F7594E"/>
            <path d="M21.0365 26.8292C21.0846 26.2923 21.1343 25.7056 21.2321 25.1687C21.9646 21.652 23.1362 18.2332 24.1621 14.7663C24.4057 13.9841 24.6012 13.2036 24.8465 12.4711C24.9923 11.8844 25.4332 11.6408 25.9204 11.6888C26.5071 11.7369 26.8965 12.0302 26.9942 12.5671C27.0920 13.2018 27.3853 13.8365 26.8484 14.4713C26.6048 14.7646 26.5071 15.2535 26.4093 15.6429C25.9701 17.1079 25.5310 18.6226 25.1879 20.0876C24.6012 22.3828 25.7248 20.6245 25.9204 20.3312C27.7765 17.6448 29.5348 14.8607 31.4887 12.3218C31.7322 12.0285 31.9776 11.7351 32.1731 11.4435C32.5642 10.9066 33.0514 10.8088 33.6381 10.9066C34.4684 11.0524 34.7617 11.6391 34.3706 12.3716C34.2728 12.5671 34.1270 12.7627 33.9795 12.9582C31.1473 17.1096 28.4609 21.4084 25.8226 25.6576C25.4812 26.1945 25.1381 26.6834 24.7968 27.1723C24.5532 27.5136 24.2598 27.8567 23.9185 28.1484C23.3815 28.6373 22.6971 28.6853 22.0143 28.4417C21.3299 28.1981 20.9885 27.5634 21.0383 26.8292H21.0365Z" fill="#F7594E"/>
            <path d="M35.1022 26.0968C34.5653 25.4621 33.8808 24.1429 34.4177 22.2388C35.4436 18.7719 37.1521 15.6944 39.6927 13.1539C40.6687 12.1281 41.8421 11.3475 43.2573 10.9067C43.9898 10.6631 44.6743 10.7609 45.3570 11.1022C46.3331 11.5414 46.7242 12.2739 46.6762 13.2997C46.5784 14.178 46.1873 14.9602 45.7979 15.6927C44.3809 18.1835 42.5248 20.2832 40.3274 22.1393C39.3993 22.9215 38.3735 23.6043 37.3477 24.239C36.9085 24.4826 36.9085 24.9715 37.3477 25.2648C37.8366 25.5581 38.3238 25.7039 38.9104 25.5581C39.5451 25.4123 40.2296 25.2648 40.8643 25.0212C44.5267 23.6043 49.6061 20.4307 52.5858 17.8902C53.0747 17.4991 53.4641 17.0119 53.9050 16.571C54.4917 15.9843 55.0286 15.9363 55.7113 16.3274C56.0527 16.571 56.2483 17.0599 56.0527 17.451C55.9549 17.6466 55.8091 17.8902 55.6616 18.0857C55.0749 18.7204 54.5380 19.4049 53.9033 19.9418C50.9733 22.5304 45.9917 25.7057 42.3773 27.1706C41.4012 27.6098 40.3257 27.9529 39.0065 27.9529C37.5896 27.8551 36.1743 27.3182 35.0988 26.0968H35.1022ZM37.4952 21.3107C37.6908 21.3605 37.8863 21.213 38.0819 21.0671C40.1816 19.3088 41.9896 17.3069 43.3568 14.9619C43.6502 14.425 44.2351 13.9361 43.8938 13.1556C43.2590 13.2036 42.7701 13.5947 42.2813 13.9859C40.0340 15.842 38.5210 18.2847 37.4455 21.0191C37.3974 21.1169 37.4455 21.2147 37.4935 21.3125L37.4952 21.3107Z" fill="#F7594E"/>
            <path d="M49.5577 27.0243C49.5097 26.4874 49.6057 25.9505 49.8510 25.4118C50.4377 24.1424 50.9746 22.8232 51.5596 21.5538C52.6335 19.3066 53.7571 17.0611 54.8326 14.7641C55.2238 13.8858 55.6149 13.0058 55.6149 11.98C55.6149 11.8822 55.6629 11.7364 55.7127 11.6386C55.8585 10.9061 56.2496 10.515 56.7385 10.5648C57.5207 10.6128 58.0576 11.1017 58.1057 11.8342C58.1057 12.4209 58.0576 13.0556 57.9599 13.6405C57.9101 14.1294 57.7163 14.5188 57.5687 15.0077C57.8621 15.2033 58.0079 15.0077 58.2035 14.8122L60.1076 12.6147C61.5245 10.9542 64.1611 11.8325 64.6981 13.6405C65.0892 14.8619 65.0892 16.0833 64.8439 17.303C64.7461 17.8399 64.3550 18.1332 63.8181 18.1813C63.1336 18.1813 62.5967 17.8399 62.4509 17.2052C62.4028 16.8141 62.4028 16.4727 62.3531 16.0816L62.2073 15.2033C62.2073 15.1055 62.0615 15.0077 62.0117 14.91C61.5726 14.8619 61.3770 15.2513 61.1814 15.4966C60.3031 16.6683 59.3751 17.8416 58.5448 19.0613C57.0301 21.3565 55.5651 23.7015 54.0521 25.9968C53.6130 26.6315 53.1241 27.2662 52.6352 27.9009C52.2938 28.3898 51.7569 28.5853 51.2182 28.5853C50.1924 28.5853 49.5577 27.9987 49.5577 27.0226V27.0243ZM57.6168 15.157L57.5687 15.0112V15.0592L57.6168 15.157Z" fill="#F7594E"/>
            <path d="M64.6012 29.956C64.4057 29.4671 64.4554 28.9799 64.6012 28.491C65.0901 26.6846 66.1159 23.2658 66.6031 21.4577C66.7009 21.0666 67.6290 18.43 68.7526 15.3045C67.4334 15.4023 66.4573 15.4503 66.3595 15.4503C65.9204 15.4023 65.4812 15.4023 65.1382 15.157C64.7968 14.9134 64.5515 14.6681 64.6012 14.2787C64.6012 13.7898 64.9426 13.692 65.3337 13.644C66.2618 13.5462 67.1898 13.4484 68.1178 13.4004L69.4370 13.3026C70.8042 9.54237 72.2692 5.68265 72.8078 4.75632C73.0034 4.3652 73.1492 3.97408 73.3945 3.63271C73.8834 2.70467 74.8115 2.65664 75.4462 3.4869C75.6417 3.78024 75.6897 4.07358 75.5920 4.3652C75.4462 4.75632 75.2506 5.14744 75.1031 5.53684C74.4684 7.00181 73.7839 8.46679 73.1989 9.93177L72.0753 13.1551C73.5403 13.0573 74.8595 12.9595 75.2009 12.9595C75.8853 12.9115 76.5680 12.8617 77.2525 12.8617C77.5939 12.8617 77.9370 12.9595 78.2286 13.3009C78.4241 13.5445 78.4722 13.8378 78.2286 14.0831C77.8872 14.5223 77.4463 14.62 76.9094 14.6698L71.4389 15.1089C69.8264 19.8469 67.5809 26.5371 66.8484 28.7843C66.7507 29.1754 66.6048 29.6146 66.4573 30.0057C66.3115 30.3471 66.0182 30.5924 65.6271 30.5924C65.1382 30.5924 64.7968 30.3968 64.6012 29.9577V29.956Z" fill="#F7594E"/>
            <path d="M81.6442 26.1954C81.5464 25.7562 81.5464 25.2673 81.4487 24.7785C81.0095 24.7304 80.8140 25.1198 80.5206 25.3154C79.8362 25.8523 79.2015 26.439 78.5187 26.9279C78.0796 27.2693 77.5907 27.5146 77.0040 27.5146C75.7826 27.5626 75.0021 26.9776 74.8546 25.7562C74.7568 24.974 74.8546 24.1935 75.0982 23.4113C76.1240 20.188 77.7845 17.258 79.9339 14.6197C80.5206 13.9352 81.1553 13.6436 82.0336 13.985C82.5225 14.1308 82.7661 14.6694 82.5225 15.1566C82.2789 15.5477 82.0336 15.8411 81.7900 16.2305C80.2753 18.3799 78.9579 20.6254 78.0778 23.166C77.9801 23.4095 77.7845 23.7029 77.9801 24.0442C78.5667 23.8487 78.9562 23.3598 79.3473 22.9704C80.8122 21.5054 82.1794 20.0404 83.5964 18.6235C84.3289 17.891 84.9155 17.8413 85.7458 18.3302C86.1369 18.5738 86.3325 18.9649 86.1850 19.404C86.0392 19.7951 85.8436 20.1863 85.6961 20.5757C85.1094 21.8948 84.5725 23.31 84.2311 24.727C84.1333 25.1661 84.0355 25.5573 84.1333 25.9964C84.1813 26.2897 84.3769 26.4356 84.6222 26.4356C84.9155 26.3875 85.2089 26.2897 85.5005 26.192C86.5263 25.7528 87.4544 25.1661 88.3327 24.4834C91.4102 22.2859 94.3401 19.8432 96.9767 17.1088C97.1723 16.8652 97.3678 16.6696 97.6114 16.4243C98.0025 16.131 98.3937 16.131 98.8328 16.3265C99.4675 16.6199 99.6631 17.1088 99.2720 17.6457C98.7831 18.2804 98.2959 18.9151 97.7092 19.4521C95.2184 22.0887 92.4840 24.4337 89.5043 26.5333C88.4305 27.3156 87.2571 28.0481 85.9397 28.3894C85.5485 28.4872 85.1094 28.585 84.6702 28.585C83.0577 28.585 82.0336 27.8028 81.6425 26.192L81.6442 26.1954Z" fill="#F7594E"/>
            <path d="M92.2911 28.7353C92.4370 28.3442 92.6823 28.0028 92.8281 27.6117C93.9997 25.1689 95.1233 22.7279 96.2950 20.2851C97.3208 18.1854 97.9555 15.9382 98.1013 13.5932C98.1493 12.9585 98.1493 12.3718 98.3946 11.7869C98.6880 11.1024 99.1769 10.9086 99.8596 11.1024C100.544 11.298 100.885 11.7869 100.983 12.4216C101.129 13.1541 101.081 13.8865 100.935 14.619L100.496 16.964C100.985 17.3054 101.374 16.8662 101.765 16.8182C103.378 16.6724 104.354 17.4529 104.354 19.1135C104.402 19.8957 104.306 20.6762 104.208 21.5065C104.062 22.6301 104.013 23.8017 104.062 24.9734C104.110 25.7556 104.502 25.9992 105.136 25.6578C105.821 25.2667 106.406 24.8756 106.992 24.4364C109.727 22.5323 112.218 20.3331 114.563 17.9898C115.051 17.4529 115.588 16.964 116.125 16.4271C116.564 15.9879 117.053 15.8902 117.640 16.0857C118.568 16.3293 118.812 16.964 118.227 17.6982C117.836 18.2352 117.348 18.7721 116.908 19.261C114.417 22.0451 111.682 24.6337 108.653 26.8312C107.677 27.5637 106.651 28.1984 105.380 28.4437C103.671 28.785 101.815 28.1503 101.424 25.9031C101.278 25.0248 101.180 24.0968 101.278 23.1687C101.376 22.3385 101.424 21.4602 101.474 20.6282L101.132 20.4824C100.693 21.069 100.254 21.654 99.863 22.2407C98.3483 24.4879 96.8353 26.7334 95.3206 28.9326C95.0273 29.3717 94.7339 29.7628 94.4423 30.1539C94.0512 30.5931 93.2707 30.6909 92.7337 30.3495C92.2448 30.0562 92.0012 29.4215 92.2946 28.737L92.2911 28.7353Z" fill="#F7594E"/>
            <path d="M114.517 26.0968C113.980 25.4621 113.295 24.1429 113.832 22.2388C114.858 18.7719 116.567 15.6944 119.107 13.1539C120.083 12.1281 121.257 11.3475 122.672 10.9067C123.404 10.6631 124.089 10.7609 124.772 11.1022C125.748 11.5414 126.139 12.2739 126.091 13.2997C125.993 14.178 125.602 14.9602 125.213 15.6927C123.796 18.1835 121.940 20.2832 119.742 22.1393C118.814 22.9215 117.788 23.6043 116.762 24.239C116.323 24.4826 116.323 24.9715 116.762 25.2648C117.251 25.5581 117.738 25.7039 118.325 25.5581C118.960 25.4123 119.644 25.2648 120.279 25.0212C123.941 23.6043 129.021 20.4307 132.000 17.8902C132.489 17.4991 132.879 17.0119 133.320 16.571C133.906 15.9843 134.443 15.9363 135.126 16.3274C135.467 16.571 135.663 17.0599 135.467 17.451C135.370 17.6466 135.224 17.8902 135.076 18.0857C134.490 18.7204 133.953 19.4049 133.318 19.9418C130.388 22.5304 125.406 25.7057 121.792 27.1706C120.816 27.6098 119.740 27.9529 118.421 27.9529C117.004 27.8551 115.589 27.3182 114.513 26.0968H114.517ZM116.910 21.3107C117.105 21.3605 117.301 21.213 117.497 21.0671C119.596 19.3088 121.404 17.3069 122.771 14.9619C123.065 14.425 123.650 13.9361 123.308 13.1556C122.674 13.2036 122.185 13.5947 121.696 13.9859C119.449 15.842 117.936 18.2847 116.860 21.0191C116.812 21.1169 116.860 21.2147 116.908 21.3125L116.910 21.3107Z" fill="#F7594E"/>
          </svg>
          <button class="profile-modal-close" id="closeProfileModal">
            <i class="bi bi-x-lg"></i>
          </button>
        </div>
        
        <div class="profile-modal-body">
          <!-- User Info Cards - Same as home page -->
          <div class="user-info-grid">
            <div class="info-card">
              <div class="info-label">Username</div>
              <div class="info-value" id="user-username"><%= username || 'Loading...' %></div>
            </div>
            <div class="info-card">
              <div class="info-label">Wallet Balance</div>
              <div class="info-value" id="user-wallet"><%= walletDisplayBalance %> USD</div>
            </div>
            <div class="info-card">
              <div class="info-label">VIP Level</div>
              <div class="info-value" id="user-vip"><%= vipLevel || 'VIP1' %></div>
            </div>
            <div class="info-card">
              <div class="info-label">Invitation Code</div>
              <div class="info-value" id="user-invitation-code"><%= invitationCode || 'N/A' %></div>
            </div>
            <div class="info-card">
              <div class="info-label">Today's Commission</div>
              <div class="info-value" id="user-commission"><%= parseFloat(todaysProfit || 0).toFixed(2) %> USD</div>
            </div>
            <div class="info-card">
              <div class="info-label">Today's Reward</div>
              <div class="info-value" id="user-reward"><%= parseFloat(todaysProfit || 0).toFixed(2) %> USD</div>
            </div>
          </div>
          
        <!-- ===== CREDIT SCORE SECTION ===== -->
        <div style="margin-bottom: 28px; padding-bottom: 28px; border-bottom: 1px solid rgba(0,0,0,0.1);">
          <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 10px;">
            <span style="font-size: 0.9rem; font-weight: 600; color: var(--gray-medium);">Credit Score</span>
            <span style="font-size: 1.1rem; font-weight: 700; color: var(--brand-coral);" id="user-credit-score-range">100%</span>
          </div>
          <!-- Progress Bar -->
          <div style="width: 100%; height: 10px; background-color: #f0f0f0; border-radius: 20px; overflow: hidden; margin-bottom: 8px;">
            <div id="credit-score-progress" style="width: 100%; height: 100%; background: linear-gradient(90deg, var(--brand-coral), var(--teal-turquoise)); border-radius: 20px;"></div>
          </div>
          <div style="display: flex; justify-content: space-between; font-size: 0.7rem; color: var(--gray-medium);">
            <span>0%</span>
            <span>Excellent</span>
            <span>100%</span>
          </div>
        </div>
          
          <!-- Profile Links Section - EXACT same arrangement as home page -->
          <div class="profile-links-section">
            <div class="profile-section-title" id="profileLinksToggle">
              <span>Profile</span>
              <i class="bi bi-chevron-down"></i>
            </div>
            
            <div class="profile-links-grid" id="profileLinksGrid">
             <a href="/deposit" class="profile-link-item"><i class="bi bi-clock-history"></i><span>Deposit History</span></a>
              <a href="/link-wallet" class="profile-link-item">
                <i class="bi bi-wallet2"></i>
                <span>My Wallet</span>
              </a>
              <a href="/withdraw" class="profile-link-item">
                <i class="bi bi-cash-stack"></i>
                <span>Withdraw</span>
              </a>
              <a href="/change-withdrawal-password" class="profile-link-item">
                <i class="bi bi-shield-lock"></i>
                <span>Change Withdrawal Password</span>
              </a>
              <a href="/vip-levels" class="profile-link-item">
                <i class="bi bi-star"></i>
                <span>VIP Level</span>
              </a>
              <a href="/salary" class="profile-link-item">
                <i class="bi bi-currency-dollar"></i>
                <span>Salary</span>
              </a>
              <a href="/certificates" class="profile-link-item">
                <i class="bi bi-patch-check"></i>
                <span>Certificates</span>
              </a>
              <a href="/faq" class="profile-link-item">
                <i class="bi bi-question-circle"></i>
                <span>FAQs</span>
              </a>
              <a href="/terms" class="profile-link-item">
                <i class="bi bi-file-text"></i>
                <span>T & C</span>
              </a>
              <a href="/reset-bonus" class="profile-link-item">
                <i class="bi bi-arrow-repeat"></i>
                <span>Reset Bonus</span>
              </a>
              <a href="/contact" class="profile-link-item">
                <i class="bi bi-envelope"></i>
                <span>Contact</span>
              </a>
              <a href="#" onclick="logout()" class="profile-link-item logout">
                <i class="bi bi-box-arrow-right"></i>
                <span>Logout</span>
              </a>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>
</nav>
  
  <!-- Overlay to close menu -->
  <div class="menu-overlay" id="menuOverlay"></div>
  
  <!-- Main Content -->
  <div class="main-content">
    <div class="container-custom">
      
    <!-- Total Balance Section -->
<div class="balance-card">
  <div class="balance-label">
    <i class="bi bi-wallet2"></i> Total Balance
  </div>
  <div class="balance-amount">
    <% if (optimizationCount >= freezingPoint) { %>
      <!-- Show deposit amount as negative with regular total balance in parentheses -->
      -<%= parseFloat(depositAmount || 0).toFixed(2) %> 
      <small style="font-size: 1rem; color: #6c757d;">(<%= parseFloat(totalBalance || 0).toFixed(2) %>)</small>
      <span>USD</span>
    <% } else { %>
      <!-- Show regular total balance -->
      <%= parseFloat(totalBalance || 0).toFixed(2) %> <span>USD</span>
    <% } %>
  </div>
  <div class="balance-note">
    <span><i class="bi bi-info-circle"></i> 
      <% if (optimizationCount >= freezingPoint) { %>
        Frozen balance: Deposit required
      <% } else { %>
        Earnings are automatically added to Total Balance
      <% } %>
    </span>
    <span class="badge bg-light text-dark"><%= vipLevel %></span>
  </div>
</div>
      
      <!-- Brands Marquee Section - Different from Home Page -->
      <div class="brands-marquee-section">
        <div class="brands-marquee-header">
          <h5 class="brands-marquee-title">
            <i class="bi bi-stars"></i> Featured Global Brands
          </h5>
          <span class="brands-tag">Premium Partners</span>
        </div>
        
        <div class="marquee-wrapper">
          <div class="marquee-content">
            <!-- First set of brands -->
            <div class="brand-item">
              <div class="brand-icon">
                <i class="bi bi-apple"></i>
              </div>
              <span class="brand-name">Apple</span>
              <span class="brand-category">Technology</span>
            </div>
            <div class="brand-item">
              <div class="brand-icon">
                <i class="bi bi-google"></i>
              </div>
              <span class="brand-name">Google</span>
              <span class="brand-category">Tech</span>
            </div>
            <div class="brand-item">
              <div class="brand-icon">
                <i class="bi bi-amazon"></i>
              </div>
              <span class="brand-name">Amazon</span>
              <span class="brand-category">E-commerce</span>
            </div>
            <div class="brand-item">
              <div class="brand-icon">
                <i class="bi bi-microsoft"></i>
              </div>
              <span class="brand-name">Microsoft</span>
              <span class="brand-category">Software</span>
            </div>
            <div class="brand-item">
              <div class="brand-icon">
                <i class="bi bi-truck"></i>
              </div>
              <span class="brand-name">FedEx</span>
              <span class="brand-category">Logistics</span>
            </div>
            <div class="brand-item">
              <div class="brand-icon">
                <i class="bi bi-camera-reels"></i>
              </div>
              <span class="brand-name">Netflix</span>
              <span class="brand-category">Entertainment</span>
            </div>
            <div class="brand-item">
              <div class="brand-icon">
                <i class="bi bi-bag"></i>
              </div>
              <span class="brand-name">Nike</span>
              <span class="brand-category">Fashion</span>
            </div>
            <div class="brand-item">
              <div class="brand-icon">
                <i class="bi bi-cup-hot"></i>
              </div>
              <span class="brand-name">Starbucks</span>
              <span class="brand-category">Food & Bev</span>
            </div>
            
            <!-- Duplicate for seamless loop -->
            <div class="brand-item">
              <div class="brand-icon">
                <i class="bi bi-apple"></i>
              </div>
              <span class="brand-name">Apple</span>
              <span class="brand-category">Technology</span>
            </div>
            <div class="brand-item">
              <div class="brand-icon">
                <i class="bi bi-google"></i>
              </div>
              <span class="brand-name">Google</span>
              <span class="brand-category">Tech</span>
            </div>
            <div class="brand-item">
              <div class="brand-icon">
                <i class="bi bi-amazon"></i>
              </div>
              <span class="brand-name">Amazon</span>
              <span class="brand-category">E-commerce</span>
            </div>
            <div class="brand-item">
              <div class="brand-icon">
                <i class="bi bi-microsoft"></i>
              </div>
              <span class="brand-name">Microsoft</span>
              <span class="brand-category">Software</span>
            </div>
            <div class="brand-item">
              <div class="brand-icon">
                <i class="bi bi-truck"></i>
              </div>
              <span class="brand-name">FedEx</span>
              <span class="brand-category">Logistics</span>
            </div>
            <div class="brand-item">
              <div class="brand-icon">
                <i class="bi bi-camera-reels"></i>
              </div>
              <span class="brand-name">Netflix</span>
              <span class="brand-category">Entertainment</span>
            </div>
            <div class="brand-item">
              <div class="brand-icon">
                <i class="bi bi-bag"></i>
              </div>
              <span class="brand-name">Nike</span>
              <span class="brand-category">Fashion</span>
            </div>
            <div class="brand-item">
              <div class="brand-icon">
                <i class="bi bi-cup-hot"></i>
              </div>
              <span class="brand-name">Starbucks</span>
              <span class="brand-category">Food & Bev</span>
            </div>
          </div>
        </div>
      </div>
      
      <!-- Commission and Optimization Section - Side by Side -->
      <div class="commission-section">
        <!-- Commission Card - Left Side -->
        <div class="commission-card">
          <div class="commission-icon">
            <i class="bi bi-cash-stack"></i>
          </div>
          <div class="commission-label">Commission</div>
          <div class="commission-amount">
            <%= parseFloat(todaysProfit || 0).toFixed(2) %> <span>USD</span>
          </div>
          <div class="commission-note">
            <i class="bi bi-clock-history"></i> System recalculates day's profit at 0:00
          </div>
        </div>
        
        <!-- Optimization Button - Right Side -->
        <div class="optimization-wrapper">
          <div class="optimization-title">
            Start Promotion
            <span class="optimization-count-badge"><%= optimizationCount || 0 %>/<%= maxOptimizationCount || 40 %></span>
          </div>
          
          <button class="optimize-button" onclick="showOverlay()">
            <i class="bi bi-lightning-charge-fill"></i>
            <span>PROMOTE</span>
          </button>
          
          <div class="optimization-footer">
            <span class="optimization-count-display">
              <span><%= optimizationCount || 0 %></span>/<span><%= maxOptimizationCount || 40 %></span>
            </span>
            <span class="optimization-limit">
              <i class="bi bi-info-circle"></i> Total promotions
            </span>
          </div>
        </div>
      </div>
      
      <!-- History Button Section - Updated -->
      <div class="history-section">
        <div class="history-button" data-bs-toggle="modal" data-bs-target="#historyModal">
          <div class="history-button-left">
            <div class="history-icon">
              <i class="bi bi-clock-history"></i>
            </div>
            <div class="history-info">
              <h6>Promotion History</h6>
              <p>View and manage your Promotion records</p>
            </div>
          </div>
          <div class="d-flex align-items-center gap-3">
            <span class="history-badge" style="background: var(--brand-coral);">Records</span>
            <i class="bi bi-chevron-right history-arrow"></i>
          </div>
        </div>
      </div>
      
      <!-- Notes Section -->
      <div class="notes-section">
        <div class="notes-title">
          <i class="bi bi-journal-text"></i> Notes
        </div>
        <div class="notes-text">
          Online Support Available from 11am to 23:00pm Eastern Time<br>
          Please contact online support for your assistance!
        </div>
      </div>
      
    </div>
  </div>
  
  <!-- Footer Links -->
  <section class="footer-links">
    <div class="container">
      <div class="row">
        <div class="col-6 col-md-3">
          <a href="/contact-us" class="footer-link-item">Contact Us</a>
        </div>
        <div class="col-6 col-md-3">
          <a href="/faq" class="footer-link-item">FAQ</a>
        </div>
        <div class="col-6 col-md-3">
          <a href="/terms" class="footer-link-item">Terms & Conditions</a>
        </div>
        <div class="col-6 col-md-3">
          <a href="/about" class="footer-link-item">About Us</a>
        </div>
      </div>
    </div>
  </section>
  
  <!-- History Modal with Full Promotion Functionality -->
  <div class="modal fade history-modal" id="historyModal" tabindex="-1" aria-labelledby="historyModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered modal-xl">
      <div class="modal-content">
       <!-- Add this after the modal-header div, before modal-body -->
<div class="modal-header">
  <h5 class="modal-title" id="historyModalLabel">
    <i class="bi bi-clock-history me-2"></i>Promotion History
  </h5>
  <div class="d-flex gap-2">
    <button class="btn btn-sm btn-outline-primary" onclick="manualRefreshHistory()" title="Refresh data">
      <i class="bi bi-arrow-repeat"></i> Refresh
    </button>
    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
  </div>
</div>
        <div class="modal-body p-4">
          <!-- Loader inside modal -->
          <div id="historyLoader" class="text-center my-5" style="display: none;">
            <div class="spinner-border text-primary" role="status">
              <span class="visually-hidden">Loading...</span>
            </div>
            <p class="mt-2">Loading history...</p>
          </div>
          
          <!-- Message overlay inside modal -->
          <div id="historyMessageOverlay" class="alert" style="display: none; position: sticky; top: 0; z-index: 10;"></div>
          
          <!-- History Tabs -->
          <div class="history-tabs-container mb-4">
            <ul class="nav nav-tabs justify-content-center" id="historyTabs">
              <li class="nav-item">
                <button class="nav-link active" id="history-all-tab" data-status="all" type="button">All</button>
              </li>
              <li class="nav-item">
                <button class="nav-link" id="history-pending-tab" data-status="pending" type="button">Pending</button>
              </li>
              <li class="nav-item">
                <button class="nav-link" id="history-completed-tab" data-status="completed" type="button">Completed</button>
              </li>
            </ul>
          </div>
          
          <!-- Cards Container -->
         <!-- Cards Container -->
<div id="history-cards-container" class="row g-3">
  <!-- Cards will be dynamically inserted here -->
</div>

<!-- No data message - OUTSIDE the container -->
<div class="col-12 text-center py-5" id="history-no-data" style="display: none;">
  <i class="bi bi-inbox" style="font-size: 3rem; color: var(--gray-light);"></i>
  <p class="mt-3 text-muted">No Promotion history available</p>
</div>
          
          <!-- Submit All Button (shown when pending/frozen exist) -->
          <div id="history-submit-container" class="text-center mt-4" style="display: none;">
            <button id="history-submit-all-button" class="btn btn-primary px-5 py-3" style="background-color: var(--brand-coral); border-radius: 50px; font-weight: 600;">
              <i class="bi bi-check2-circle me-2"></i>Submit All Pending
            </button>
            <p class="text-muted small mt-2">Complete all pending and frozen Promotions</p>
          </div>
        </div>
      </div>
    </div>
  </div>

    <!-- Loader Overlay -->
  <div class="loader-overlay" id="loaderOverlay">
    <div class="loader-container">
      <div class="loader-spinner"></div>
      <div class="loader-text">
        Processing...
        <small>Please wait</small>
      </div>
    </div>
  </div>
  
    <!-- Small Error Message Overlay -->
  <div class="error-overlay" id="errorOverlay">
    <div class="error-content">
      <div class="error-icon">
        <i class="bi bi-exclamation-triangle-fill"></i>
      </div>
      <div class="error-message" id="errorMessage">
        Error message will appear here
      </div>
      <button class="error-close" onclick="closeErrorOverlay()">
        <i class="bi bi-x-lg"></i>
      </button>
    </div>
  </div>
  
  <!-- Image Modal for Task Submission -->
  <div class="modal fade" id="imageModal" tabindex="-1" aria-labelledby="imageModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered modal-sm">
      <div class="modal-content text-center">
        <div class="modal-header py-2">
          <h5 class="modal-title w-100 text-center" id="imageModalLabel">Task Submission</h5>
          <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
        </div>
        <div class="modal-body p-3">
          <div class="d-flex align-items-start mb-2">
            <img id="modalImage" class="img-fluid selected-image me-2" alt="Selected Image" style="max-width: 80px; height: auto;">
            <div>
              <h6 id="imageName" class="mb-1">Product Name</h6>
              <p class="mb-1">USDC <span id="usdcAmount" class="usdc-amount"></span></p>
              <img src="/images/fivestar.png" alt="Five Stars" style="width: 60px;">
            </div>
          </div>
          
          <hr class="my-2">
          
          <div class="d-flex justify-content-center mb-2">
            <div class="text-center me-3">
              <p class="mb-1">Total Amount</p>
              <p class="mb-0">USDC <span class="text-blue" id="totalUsdcAmount"></span></p>
            </div>
            <div class="vr"></div>
            <div class="text-center ms-3">
              <p class="mb-1">Profit</p>
              <p class="mb-0">USDC <span class="text-blue" id="profitAmount"></span></p>
            </div>
          </div>
          
          <div class="task-code-section text-center mt-2">
            <hr class="my-2">
            <p class="mb-0">Task Code: <span id="taskCode" class="text-blue"></span></p>
            <hr class="my-2">
          </div>
          
          <button id="submitButton" type="button" class="btn btn-danger w-100 mt-2">Submit</button>
        </div>
      </div>
    </div>
  </div>
  
  <!-- Bootstrap JS -->
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
  
  <script>
// Brand-focused image assets - Luxury, Fashion, Automotive, Lifestyle
const images = [
  '/images/louis-vuitton-bag.jpg',
  '/images/gucci-belt.jpg',
  '/images/hermes-scarf.jpg', 
  '/images/chanel-perfume.jpg',
  '/images/prada-sunglasses.jpg',
  '/images/versace-dress.jpg',
  '/images/dior-handbag.jpg',
  '/images/burberry-coat.jpg',
  '/images/cartier-watch.jpg',
  '/images/tiffany-necklace.jpg',
  '/images/rolex-watch.jpg',
  '/images/armani-suit.jpg',
  '/images/balenciaga-sneakers.jpg',
  '/images/fendi-bag.jpg',
  '/images/yves-saint-laurent-heels.jpg',
  '/images/mercedes-benz.jpg',
  '/images/bmw-series.jpg',
  '/images/audi-r8.jpg',
  '/images/porsche-911.jpg',
  '/images/tesla-model-s.jpg',
  '/images/ferrari-488.jpg',
  '/images/lamborghini-urus.jpg',
  '/images/range-rover-sport.jpg',
  '/images/lexus-lx.jpg',
  '/images/bentley-continental.jpg',
  '/images/lancome-serum.jpg',
  '/images/estee-lauder-cream.jpg',
  '/images/mac-lipstick.jpg',
  '/images/clarins-oil.jpg',
  '/images/loreal-shampoo.jpg',
  '/images/dior-makeup.jpg',
  '/images/chanel-foundation.jpg',
  '/images/ysl-lipstick.jpg',
  '/images/guerlain-perfume.jpg',
  '/images/shiseido-cream.jpg',
  '/images/coca-cola.jpg',
  '/images/pepsi-cola.jpg',
  '/images/nestle-coffee.jpg',
  '/images/starbucks-reserve.jpg',
  '/images/red-bull.jpg',
  '/images/monster-energy.jpg',
  '/images/danone-yogurt.jpg',
  '/images/heineken-beer.jpg',
  '/images/corona-extra.jpg',
  '/images/johnnie-walker.jpg',
  '/images/hennessy-cognac.jpg',
  '/images/moet-chandon.jpg',
  '/images/nike-air-max.jpg',
  '/images/adidas-ultraboost.jpg',
  '/images/puma-suede.jpg',
  '/images/under-armour-hoodie.jpg',
  '/images/rebook-classic.jpg',
  '/images/new-balance-574.jpg',
  '/images/asics-gel.jpg',
  '/images/fila-disruptor.jpg',
  '/images/apple-iphone-15.jpg',
  '/images/samsung-s25.jpg',
  '/images/sony-headphones.jpg',
  '/images/bose-speaker.jpg',
  '/images/dell-xps-13.jpg',
  '/images/hp-spectre.jpg',
  '/images/canon-eos-r6.jpg',
  '/images/nintendo-switch-2.jpg',
  '/images/xbox-series-x-console.jpg',
  '/images/ps5-digital.jpg',
  '/images/omega-seamaster.jpg',
  '/images/tag-heuer-carrera.jpg',
  '/images/breitling-navitimer.jpg',
  '/images/hublot-big-bang.jpg',
  '/images/patek-philippe.jpg',
  '/images/audemars-piguet.jpg',
  '/images/bvlgari-ring.jpg',
  '/images/cartier-love-bracelet.jpg',
  '/images/dyson-vacuum.jpg',
  '/images/sonos-speaker.jpg',
  '/images/bang-olufsen.jpg',
  '/images/philips-hue.jpg',
  '/images/kitchenaid-mixer.jpg',
  '/images/smeg-fridge.jpg',
  '/images/henckels-knives.jpg',
  '/images/le-creuset-pot.jpg'
];

const names = [
  'Louis Vuitton Neverfull Bag',
  'Gucci GG Marmont Belt',
  'Herms Silk Carre Scarf',
  'Chanel No.5 Perfume',
  'Prada Linea Rossa Sunglasses',
  'Versace Medusa Dress',
  'Dior Lady Handbag',
  'Burberry Kensington Coat',
  'Cartier Ballon Bleu Watch',
  'Tiffany & Co. Heart Tag Necklace',
  'Rolex Submariner Date',
  'Armani Emporio Suit',
  'Balenciaga Triple S Sneakers',
  'Fendi Peekaboo Bag',
  'YSL Tribtoo Heels',
  'Mercedes-Benz S-Class',
  'BMW 7 Series',
  'Audi R8 V10',
  'Porsche 911 Turbo S',
  'Tesla Model S Plaid',
  'Ferrari 488 GTB',
  'Lamborghini Urus',
  'Range Rover Sport',
  'Lexus LX 600',
  'Bentley Continental GT',
  'Lancme Advanced Gnifique Serum',
  'Este Lauder Revitalizing Cream',
  'MAC Ruby Woo Lipstick',
  'Clarins Huile Santal Oil',
  'L\'Oral Professionnel Shampoo',
  'Dior Forever Foundation',
  'Chanel Les Beiges Powder',
  'YSL Tatouage Couture Lipstick',
  'Guerlain Mon Guerlain Perfume',
  'Shiseido Ultimune Serum',
  'Coca-Cola Classic',
  'Pepsi Next Generation',
  'Nestl Gold Blend Coffee',
  'Starbucks Reserve Blend',
  'Red Bull Energy Drink',
  'Monster Energy Ultra',
  'Danone Oikos Yogurt',
  'Heineken Premium Lager',
  'Corona Extra Beer',
  'Johnnie Walker Blue Label',
  'Hennessy X.O Cognac',
  'Mot & Chandon Imperial',
  'Nike Air Max 270',
  'Adidas Ultraboost 23',
  'Puma Suede Classic',
  'Under Armour Rival Hoodie',
  'Reebok Club C 85',
  'New Balance 574 Core',
  'Asics Gel-Kayano 29',
  'Fila Disruptor II',
  'Apple iPhone 15 Pro Max',
  'Samsung Galaxy S25 Ultra',
  'Sony WH-1000XM5 Headphones',
  'Bose QuietComfort Ultra',
  'Dell XPS 13 Plus',
  'HP Spectre x360',
  'Canon EOS R6 Mark II',
  'Nintendo Switch OLED',
  'Xbox Series X Console',
  'PlayStation 5 Digital Edition',
  'Omega Seamaster Diver',
  'Tag Heuer Carrera Chronograph',
  'Breitling Navitimer B01',
  'Hublot Big Bang Unico',
  'Patek Philippe Nautilus',
  'Audemars Piguet Royal Oak',
  'Bvlgari Serpenti Ring',
  'Cartier Love Bracelet',
  'Dyson V15 Detect Vacuum',
  'Sonos Era 300 Speaker',
  'Bang & Olufsen Beosound',
  'Philips Hue White Ambiance',
  'KitchenAid Artisan Mixer',
  'Smeg FAB28 Refrigerator',
  'Zwilling Henckels Knives Set',
  'Le Creuset Dutch Oven'
];

const usdcAmounts = [
320, 300, 220, 150, 180, 450, 270, 450,
230, 390, 140, 350, 41, 380, 260, 290,
16, 430, 47, 21, 33, 210, 430, 340,
150, 25, 38, 12, 310, 450, 44, 19,
30, 15, 42, 470, 250, 160, 36, 350,
390, 22, 420, 480, 48, 13, 310, 490,
270, 140, 117, 330, 126, 49, 390, 350,
120, 300, 220, 150, 146, 110, 370, 450,
128, 43, 24, 350, 31, 380, 260, 14,
150, 430, 19, 34, 15, 210, 430, 340,
150, 141, 126, 138, 310, 450, 12, 47,
202, 313, 118, 470, 250, 160, 45, 350,
390, 209, 420, 480, 16, 40, 310, 490,
270, 201, 48, 330, 35, 13, 470, 42
];

const usdcAmountsVIP1 = [
 43, 28, 35, 22, 47, 31, 18, 42,
26, 39, 14, 45, 33, 21, 48, 16,
37, 24, 41, 19, 46, 12, 29, 44,
27, 38, 15, 49, 32, 23, 36, 13,
40, 25, 17, 50, 30, 20, 34, 11,
41, 28, 15, 37, 22, 44, 19, 33,
26, 48, 12, 39, 24, 46, 18, 35,
29, 16, 42, 21, 47, 13, 38, 25,
31, 49, 14, 27, 43, 20, 36, 11,
34, 23, 40, 17, 45, 30, 15, 48,
19, 32, 50, 26, 37, 22, 41, 14,
28, 44, 18, 35, 12, 46, 21, 39,
16, 47, 25, 33, 29, 42, 13, 38,
24, 45, 20, 31, 17, 48, 36, 40
];

// ===== PROFILE MODAL FUNCTIONS =====
function initProfileModal() {
  const profileMenuToggle = document.getElementById('profileMenuToggle');
  const closeProfileModal = document.getElementById('closeProfileModal');
  const profileModal = document.getElementById('profileModal');
  const profileOverlay = document.getElementById('profileOverlay');
  const profileLinksToggle = document.getElementById('profileLinksToggle');
  const profileLinksGrid = document.getElementById('profileLinksGrid');
  
  if (profileMenuToggle) {
    profileMenuToggle.addEventListener('click', function(e) {
      e.stopPropagation();
      profileModal.classList.add('show');
      profileOverlay.classList.add('show');
      document.body.style.overflow = 'hidden';
      setTimeout(() => {
        if (profileLinksGrid) {
          profileLinksGrid.classList.add('show');
          if (profileLinksToggle) profileLinksToggle.classList.add('active');
        }
      }, 300);
    });
  }
  
  if (closeProfileModal) {
    closeProfileModal.addEventListener('click', function() {
      closeProfileModalFn();
    });
  }
  
  if (profileOverlay) {
    profileOverlay.addEventListener('click', function() {
      closeProfileModalFn();
    });
  }
  
  if (profileLinksToggle) {
    profileLinksToggle.addEventListener('click', function(e) {
      e.stopPropagation();
      this.classList.toggle('active');
      if (profileLinksGrid) {
        profileLinksGrid.classList.toggle('show');
        const chevron = this.querySelector('i.bi-chevron-down, i.bi-chevron-up');
        if (chevron) {
          if (profileLinksGrid.classList.contains('show')) {
            chevron.classList.remove('bi-chevron-down');
            chevron.classList.add('bi-chevron-up');
          } else {
            chevron.classList.remove('bi-chevron-up');
            chevron.classList.add('bi-chevron-down');
          }
        }
      }
    });
  }
  
  document.addEventListener('keydown', function(e) {
    if (e.key === 'Escape' && profileModal && profileModal.classList.contains('show')) {
      closeProfileModalFn();
    }
  });
  
  if (profileModal) {
    profileModal.addEventListener('click', function(e) {
      e.stopPropagation();
    });
  }
}

function closeProfileModalFn() {
  const profileModal = document.getElementById('profileModal');
  const profileOverlay = document.getElementById('profileOverlay');
  const profileLinksGrid = document.getElementById('profileLinksGrid');
  const profileLinksToggle = document.getElementById('profileLinksToggle');
  
  if (profileModal) profileModal.classList.remove('show');
  if (profileOverlay) profileOverlay.classList.remove('show');
  document.body.style.overflow = '';
  if (profileLinksGrid) profileLinksGrid.classList.remove('show');
  if (profileLinksToggle) {
    profileLinksToggle.classList.remove('active');
    const chevron = profileLinksToggle.querySelector('i.bi-chevron-down, i.bi-chevron-up');
    if (chevron) {
      chevron.classList.remove('bi-chevron-up');
      chevron.classList.add('bi-chevron-down');
    }
  }
}

function initProfileMenu() {
  const profileMenuToggle = document.getElementById('profileMenuToggle');
  const closeProfileMenu = document.getElementById('closeProfileMenu');
  const profileMenu = document.getElementById('profileMenu');
  const menuOverlay = document.getElementById('menuOverlay');
  
  if (profileMenuToggle && profileMenu) {
    profileMenuToggle.addEventListener('click', function(e) {
      e.stopPropagation();
      profileMenu.classList.toggle('show');
      menuOverlay.style.display = profileMenu.classList.contains('show') ? 'block' : 'none';
    });
  }
  
  if (closeProfileMenu) {
    closeProfileMenu.addEventListener('click', function() {
      profileMenu.classList.remove('show');
      menuOverlay.style.display = 'none';
    });
  }
  
  if (menuOverlay) {
    menuOverlay.addEventListener('click', function() {
      if (profileMenu) profileMenu.classList.remove('show');
      menuOverlay.style.display = 'none';
    });
  }
  
  document.addEventListener('keydown', function(e) {
    if (e.key === 'Escape' && profileMenu && profileMenu.classList.contains('show')) {
      profileMenu.classList.remove('show');
      menuOverlay.style.display = 'none';
    }
  });
}

// ===== UTILITY FUNCTIONS =====
function getProfitRate(vipLevel) {
  switch(vipLevel) {
    case 'VIP1': return 0.005;
    case 'VIP2': return 0.01;
    case 'VIP3': return 0.015;
    case 'VIP4': return 0.02;
    default: return 0.005;
  }
}

function showLoader(message = 'Processing...') {
  const loader = document.getElementById('loaderOverlay');
  const loaderText = loader.querySelector('.loader-text');
  if (loaderText) loaderText.innerHTML = message + '<small>Please wait</small>';
  loader.classList.add('show');
}

function hideLoader() {
  const loader = document.getElementById('loaderOverlay');
  loader.classList.remove('show');
}

function showError(message) {
  const errorOverlay = document.getElementById('errorOverlay');
  const errorMessage = document.getElementById('errorMessage');
  if (errorOverlay && errorMessage) {
    errorMessage.textContent = message;
    errorOverlay.classList.add('show');
    setTimeout(() => { closeErrorOverlay(); }, 5000);
  }
}

function closeErrorOverlay() {
  const errorOverlay = document.getElementById('errorOverlay');
  if (errorOverlay) errorOverlay.classList.remove('show');
}

function displayError(errorMessage) {
  hideLoader();
  showError(errorMessage);
  console.log('Error:', errorMessage);
}

function showSuccessMessage(message) {
  const successDiv = document.createElement('div');
  successDiv.className = 'alert alert-success position-fixed top-50 start-50 translate-middle';
  successDiv.style.zIndex = '10001';
  successDiv.style.minWidth = '300px';
  successDiv.style.textAlign = 'center';
  successDiv.style.boxShadow = '0 10px 30px rgba(0,0,0,0.2)';
  successDiv.style.borderRadius = '10px';
  successDiv.style.padding = '15px 20px';
  successDiv.innerHTML = `<i class="bi bi-check-circle-fill me-2" style="color: #28a745;"></i><strong>${message}</strong>`;
  document.body.appendChild(successDiv);
  setTimeout(() => { successDiv.remove(); }, 2000);
}

function showHistoryMessage(message, type) {
  const overlay = document.getElementById('historyMessageOverlay');
  if (!overlay) return;
  overlay.className = `alert alert-${type}`;
  overlay.innerHTML = message;
  overlay.style.display = 'block';
  setTimeout(() => { overlay.style.display = 'none'; }, 4000);
}

function displayImageModal(selectedImage, selectedName, selectedUSDC, profit) {
  document.getElementById("modalImage").src = selectedImage;
  document.getElementById("imageName").innerText = selectedName;
  document.getElementById("usdcAmount").innerText = selectedUSDC;
  document.getElementById("totalUsdcAmount").innerText = selectedUSDC;
  document.getElementById("profitAmount").textContent = profit;
  const taskCode = Array.from({ length: 30 }, () => Math.floor(Math.random() * 10)).join('');
  document.getElementById("taskCode").innerText = taskCode;
  const modal = new bootstrap.Modal(document.getElementById('imageModal'));
  modal.show();
}

async function refreshUIFromBackend() {
  try {
    const res = await fetch('/api/start-page/user-stats?_=' + Date.now(), { cache: 'no-store' });
    const data = await res.json();
    if (!data.success) return;

    // Optimization count
    const countSpan = document.querySelector('.optimization-count-display span:first-child');
    const badgeElement = document.querySelector('.optimization-count-badge');
    if (countSpan) countSpan.textContent = data.optimizationCount;
    if (badgeElement) badgeElement.textContent = `${data.optimizationCount}/${data.maxOptimizationCount}`;

    // Commission card
    const commissionElement = document.querySelector('.commission-amount');
    if (commissionElement) commissionElement.innerHTML = `${data.todaysProfit} <span>USD</span>`;

    // Profile panel
    const userCommission = document.getElementById('user-commission');
    if (userCommission) userCommission.textContent = `${data.todaysProfit} USD`;
    const userReward = document.getElementById('user-reward');
    if (userReward) userReward.textContent = `${data.todaysProfit} USD`;
    const userWallet = document.getElementById('user-wallet');
    if (userWallet) userWallet.textContent = `${data.walletDisplayBalance || data.totalBalance} USD`;

    // Balance card - handles both frozen and normal states
    const balanceElement = document.querySelector('.balance-amount');
    if (balanceElement) {
      if (data.isFrozen) {
        balanceElement.innerHTML = `-${data.depositAmount} <small style="font-size: 1rem; color: #6c757d;">(${data.totalBalance})</small> <span>USD</span>`;
      } else {
        balanceElement.innerHTML = `${data.totalBalance} <span>USD</span>`;
      }
    }
  } catch (err) {
    console.error('Failed to refresh UI stats:', err);
  }
}

// ===== MAIN PROMOTION FUNCTIONS =====
async function showOverlay() {
  showLoader('Creating promotion...');
  
  const vipLevel = "<%= vipLevel || 'VIP1' %>";
  const username = "<%= username || '' %>";
  
  const randomIndex = Math.floor(Math.random() * images.length);
  const selectedImage = images[randomIndex];
  const selectedName = names[randomIndex];
  const selectedUSDC = vipLevel === "VIP1"
    ? usdcAmountsVIP1[randomIndex % usdcAmountsVIP1.length]
    : usdcAmounts[randomIndex % usdcAmounts.length];
  
  const profitRate = getProfitRate(vipLevel);
  const profit = (selectedUSDC * profitRate).toFixed(2);
  
  const optimizationCountElement = document.querySelector('.optimization-count-display span:first-child');
  let currentCount = parseInt(optimizationCountElement ? optimizationCountElement.textContent : "<%= optimizationCount || 0 %>");
  const maxCount = parseInt("<%= maxOptimizationCount || 40 %>");
  const updatedCount = Math.min(currentCount + 1, maxCount);
  
  try {
    const response = await fetch('/api/optimizations', {
      method: 'POST',
      headers: { 'Content-Type': 'application/json' },
      body: JSON.stringify({
        username,
        selectedImage,
        imageName: selectedName,
        usdcAmount: selectedUSDC,
        profitAmount: profit,
        optimizationCount: updatedCount,
        status: 'pending'
      })
    });
    
    const result = await response.json();
    hideLoader();
    
    if (!result.success) {
      displayError(result.message || 'Failed to save Promotion');
    } else {
      displayImageModal(selectedImage, selectedName, selectedUSDC, profit);
    }
  } catch (error) {
    console.error('Error:', error);
    hideLoader();
    displayError('An error occurred. Please try again.');
  }
}

async function handleSubmit() {
  const submitButton = document.getElementById('submitButton');
  showLoader('Submitting promotion...');
  
  const username = "<%= username || '' %>";
  const profitAmount = parseFloat(document.getElementById("profitAmount").textContent) || 0;
  
  const modalElement = document.getElementById('imageModal');
  const modal = bootstrap.Modal.getInstance(modalElement);
  
  try {
    const response = await fetch('/updateProgress', {
      method: 'POST',
      headers: { 'Content-Type': 'application/json' },
      body: JSON.stringify({
        username,
        todaysProfit: profitAmount,
        totalBalance: profitAmount
      })
    });
    
    const result = await response.json();
    
    if (result.success) {
      if (modal) modal.hide();
      await refreshUIFromBackend();
      hideLoader();
      showSuccessMessage('Promotion completed successfully!');
    } else {
      if (modal) modal.hide();
      hideLoader();
      if (submitButton) {
        submitButton.disabled = false;
        submitButton.innerHTML = 'Submit';
      }
      displayError(result.message || 'Failed to update progress');
    }
  } catch (error) {
    console.error('Error:', error);
    if (modal) modal.hide();
    hideLoader();
    if (submitButton) {
      submitButton.disabled = false;
      submitButton.innerHTML = 'Submit';
    }
    displayError('Network error. Please try again.');
  }
}

// ===== HISTORY FUNCTIONS =====
async function loadHistoryData() {
  console.log(' Loading history data at', new Date().toLocaleTimeString());
  
  const loader = document.getElementById('historyLoader');
  const container = document.getElementById('history-cards-container');
  const noDataMsg = document.getElementById('history-no-data');
  const submitContainer = document.getElementById('history-submit-container');
  
  if (!loader || !container || !noDataMsg || !submitContainer) {
    console.error('Missing elements');
    return;
  }
  
  loader.style.display = 'block';
  container.innerHTML = '';
  noDataMsg.style.display = 'none';
  submitContainer.style.display = 'none';
  
  document.querySelectorAll('#historyTabs .nav-link').forEach(t => t.classList.remove('active'));
  const allTab = document.querySelector('#historyTabs .nav-link[data-status="all"]');
  if (allTab) allTab.classList.add('active');
  
  try {
    const url = `/api/start-page/history?_=${Date.now()}&r=${Math.floor(Math.random() * 1000000)}`;
    const response = await fetch(url, {
      method: 'GET',
      headers: {
        'Cache-Control': 'no-cache, no-store, must-revalidate',
        'Pragma': 'no-cache',
        'Expires': '0',
      },
      cache: 'no-store'
    });
    
    const data = await response.json();
    loader.style.display = 'none';
    
    if (data.success && data.optimizations && data.optimizations.length > 0) {
      const sortedOptimizations = [...data.optimizations].sort((a, b) => {
        const statusOrder = { 'frozen': 1, 'pending': 2, 'completed': 3 };
        return (statusOrder[a.status] || 4) - (statusOrder[b.status] || 4);
      });
      
      let cardsHtml = '';
      let hasPendingOrFrozen = false;
      
      sortedOptimizations.forEach(opt => {
        if (opt.status === 'pending' || opt.status === 'frozen') hasPendingOrFrozen = true;
        cardsHtml += generateHistoryCard(opt, data.maxOptimizationCount);
      });
      
      container.innerHTML = cardsHtml;
      submitContainer.style.display = hasPendingOrFrozen ? 'block' : 'none';
      filterHistoryCards('all');
    } else {
      noDataMsg.style.display = 'block';
    }
  } catch (error) {
    console.error(' Error loading history:', error);
    loader.style.display = 'none';
    noDataMsg.style.display = 'block';
    const messageOverlay = document.getElementById('historyMessageOverlay');
    if (messageOverlay) {
      messageOverlay.className = 'alert alert-danger';
      messageOverlay.innerHTML = 'Failed to load history data. Please try again.';
      messageOverlay.style.display = 'block';
      setTimeout(() => { messageOverlay.style.display = 'none'; }, 4000);
    }
  }
}

function generateHistoryCard(opt, maxOptimizationCount) {
  const status = opt.status;
  let statusClass = '';
  let statusText = '';
  
  switch(status) {
    case 'completed': statusClass = 'status-completed'; statusText = 'Completed'; break;
    case 'pending':   statusClass = 'status-pending';   statusText = 'Pending';   break;
    case 'frozen':    statusClass = 'status-frozen';    statusText = 'Frozen';    break;
    default:          statusClass = 'status-pending';   statusText = 'Pending';
  }
  
  const submissionDate = opt.submissionDate ? new Date(opt.submissionDate) : new Date();
  const formattedDate = submissionDate.toLocaleDateString('en-US', {
    year: 'numeric', month: 'short', day: 'numeric',
    hour: '2-digit', minute: '2-digit'
  });
  
  return `
    <div class="col-12 col-md-6 col-lg-4 history-card-wrapper" data-status="${status === 'frozen' ? 'pending' : status}" data-id="${opt._id}">
      <div class="history-card">
        <span class="status-badge ${statusClass}">${statusText}</span>
        ${status === 'pending' || status === 'frozen' ? `
          <button class="btn submit-btn-inline" onclick="submitSingleOptimization('${opt._id}', this)" style="position: absolute; bottom: 15px; right: 15px;">
            Submit
          </button>
        ` : ''}
        <div class="d-flex align-items-start mb-3">
          <img src="${opt.selectedImage || '/images/default-product.jpg'}" alt="${opt.imageName || 'Product'}" class="card-image" onerror="this.src='/images/placeholder.jpg'">
          <div>
            <h6 class="fw-bold mb-1">${opt.imageName || 'Unknown Product'}</h6>
            <p class="mb-0 small">USDC: <span class="amount-text">${parseFloat(opt.usdcAmount || 0).toFixed(2)}</span></p>
            <p class="mb-0 small text-muted">${formattedDate}</p>
          </div>
        </div>
        <div class="card-footer-stats">
          <div class="stat-item">
            <div class="stat-label">Total Amount</div>
            <div class="stat-value">USDC ${parseFloat(opt.usdcAmount || 0).toFixed(2)}</div>
          </div>
          <div class="stat-item">
            <div class="stat-label">Commission</div>
            <div class="stat-value">USDC ${parseFloat(opt.profitAmount || 0).toFixed(2)}</div>
          </div>
          <div class="stat-item">
            <div class="stat-label">Task Progress</div>
            <div class="stat-value">${opt.optimizationCount || 0}/${maxOptimizationCount || 40}</div>
          </div>
        </div>
      </div>
    </div>
  `;
}

function filterHistoryCards(status) {
  const cards = document.querySelectorAll('.history-card-wrapper');
  const noDataMsg = document.getElementById('history-no-data');
  let visibleCount = 0;
  
  cards.forEach(card => {
    const cardStatus = card.dataset.status;
    if (status === 'all' || cardStatus === status) {
      card.style.display = 'block';
      visibleCount++;
    } else {
      card.style.display = 'none';
    }
  });
  
  if (noDataMsg) noDataMsg.style.display = visibleCount === 0 ? 'block' : 'none';
}

async function submitAllHistoryOptimizations() {
  const submitBtn = document.getElementById('history-submit-all-button');
  if (!submitBtn) return;
  
  const originalText = submitBtn.innerHTML;
  submitBtn.innerHTML = '<span class="spinner-border spinner-border-sm me-2"></span>Processing...';
  submitBtn.disabled = true;
  showHistoryMessage('Processing your Promotions...', 'info');
  
  try {
    const response = await fetch('/api/start-page/submit-history-optimizations', {
      method: 'POST',
      headers: { 'Content-Type': 'application/json' }
    });
    
    const data = await response.json();
    
    if (data.redirect) {
      window.location.href = data.redirect;
      return;
    }
    
    if (data.success) {
      await refreshUIFromBackend();
      showHistoryMessage(' ' + data.message, 'success');
      showSuccessMessage('All promotions completed!');
      submitBtn.innerHTML = originalText;
      submitBtn.disabled = false;
      setTimeout(() => { loadHistoryData(); }, 800);
    } else {
      showHistoryMessage(' ' + data.message, 'danger');
      submitBtn.innerHTML = originalText;
      submitBtn.disabled = false;
    }
  } catch (error) {
    console.error('Error submitting Promotions:', error);
    showHistoryMessage('Network error. Please try again.', 'danger');
    submitBtn.innerHTML = originalText;
    submitBtn.disabled = false;
  }
}

async function submitSingleOptimization(optimizationId, buttonElement) {
  const button = buttonElement;
  const originalText = button.innerHTML;
  button.innerHTML = '<span class="spinner-border spinner-border-sm me-2"></span>Processing...';
  button.disabled = true;
  showHistoryMessage('Processing Promotion...', 'info');
  
  try {
    const response = await fetch('/api/start-page/submit-history-optimizations', {
      method: 'POST',
      headers: { 'Content-Type': 'application/json' },
      body: JSON.stringify({ optimizationId })
    });
    
    const data = await response.json();
    
    if (data.redirect) {
      window.location.href = data.redirect;
      return;
    }
    
    if (data.success) {
      await refreshUIFromBackend();
      showHistoryMessage(' Promotion completed successfully!', 'success');
      showSuccessMessage('Promotion completed!');
      setTimeout(() => { loadHistoryData(); }, 800);
    } else {
      showHistoryMessage(' ' + data.message, 'danger');
      button.innerHTML = originalText;
      button.disabled = false;
    }
  } catch (error) {
    console.error('Error submitting Promotion:', error);
    showHistoryMessage('Network error. Please try again.', 'danger');
    button.innerHTML = originalText;
    button.disabled = false;
  }
}

function manualRefreshHistory() {
  console.log(' Manual refresh triggered');
  loadHistoryData();
  showHistoryMessage('Refreshing data...', 'info');
}

// ===== LOGOUT =====
function logout() {
  if (confirm('Are you sure you want to logout?')) {
    fetch('/api/logout', {
      method: 'POST',
      headers: { 'Content-Type': 'application/json' }
    })
    .then(response => response.json())
    .then(data => {
      if (data.success) {
        window.location.href = '/?auth=login&message=' + encodeURIComponent('Logged out successfully');
      } else {
        alert('Logout failed. Please try again.');
      }
    })
    .catch(error => {
      console.error('Logout error:', error);
      alert('Logout failed. Please try again.');
    });
  }
}

// ===== HISTORY MODAL SETUP =====
function setupHistoryModal() {
  const historyModal = document.getElementById('historyModal');
  if (!historyModal) return;
  
  historyModal.removeEventListener('show.bs.modal', handleModalShow);
  historyModal.removeEventListener('shown.bs.modal', handleModalShown);
  historyModal.removeEventListener('hidden.bs.modal', handleModalHidden);
  historyModal.addEventListener('show.bs.modal', handleModalShow);
  historyModal.addEventListener('shown.bs.modal', handleModalShown);
  historyModal.addEventListener('hidden.bs.modal', handleModalHidden);
  
  document.querySelectorAll('#historyTabs .nav-link').forEach(tab => {
    tab.removeEventListener('click', handleTabClick);
    tab.addEventListener('click', handleTabClick);
  });
  
  const submitAllBtn = document.getElementById('history-submit-all-button');
  if (submitAllBtn) {
    submitAllBtn.removeEventListener('click', submitAllHistoryOptimizations);
    submitAllBtn.addEventListener('click', submitAllHistoryOptimizations);
  }
}

function handleModalShow() {
  setTimeout(() => { loadHistoryData(); }, 100);
}

function handleModalShown() {
  const container = document.getElementById('history-cards-container');
  if (container && container.children.length === 0) loadHistoryData();
}

function handleModalHidden() {
  console.log('History modal closed');
}

function handleTabClick(e) {
  e.preventDefault();
  document.querySelectorAll('#historyTabs .nav-link').forEach(t => t.classList.remove('active'));
  this.classList.add('active');
  filterHistoryCards(this.dataset.status);
}

// ===== INITIALIZATION =====
document.addEventListener('DOMContentLoaded', function() {
  initProfileModal();
  initProfileMenu();
  
  const submitButton = document.getElementById('submitButton');
  if (submitButton) submitButton.addEventListener('click', handleSubmit);
  
  setupHistoryModal();
  
  document.addEventListener('click', function(event) {
    const errorOverlay = document.getElementById('errorOverlay');
    if (errorOverlay && errorOverlay.classList.contains('show')) {
      if (!errorOverlay.contains(event.target)) closeErrorOverlay();
    }
  });
});
</script>
</body>
</html>
