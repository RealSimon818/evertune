<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Deposit History · Evertune</title>
  <link rel="icon" href="images/logo.jpg" type="image/x-icon">
  <script src="https://cdn.tailwindcss.com"></script>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
  <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons/font/bootstrap-icons.css" rel="stylesheet">
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@300;400;500;600;700&family=Manrope:wght@300;400;500;600;700&family=DM+Sans:wght@500&display=swap" rel="stylesheet">
  <style>
    /* ===== palette & global ===== */
    :root {
      --brand-coral: #F7594E;
      --pure-white: #FFFFFF;
      --deep-black: #1B1B1B;
      --cream-peach: #FFF9F6;
      --teal-turquoise: #69D7DE;
      --warm-beige: #F9DCB7;
      --off-white: #FDFEFE;
      --gray-medium: #6C757D;
      --card-shadow: 0 4px 14px rgba(0,0,0,0.08);
    }
    * { font-family: 'Manrope', sans-serif; color: var(--deep-black); }
    body {
      background: linear-gradient(135deg, var(--cream-peach) 0%, var(--warm-beige) 50%, var(--teal-turquoise) 100%);
      background-size: 200% 200%;
      animation: gradientShift 15s ease infinite;
      min-height: 100vh;
      margin: 0;
      padding-top: 80px;
      padding-bottom: 40px;
    }
    @keyframes gradientShift {
      0%   { background-position: 0%   50%; }
      50%  { background-position: 100% 50%; }
      100% { background-position: 0%   50%; }
    }

    /* ===== navbar ===== */
    .navbar {
      background: var(--pure-white);
      box-shadow: 0 2px 10px rgba(0,0,0,0.05);
      padding: 15px 0;
      position: fixed;
      top: 0; left: 0; right: 0;
      z-index: 1030;
      height: 70px;
    }
    .navbar-container {
      width: 100%; max-width: 1200px;
      margin: 0 auto; padding: 0 15px;
      display: flex; justify-content: space-between; align-items: center;
    }
    .navbar-left  { display: flex; align-items: center; flex: 1; }
    .navbar-right { display: flex; align-items: center; justify-content: flex-end; flex: 1; gap: 15px; }
    .logo-wrapper { display: flex; align-items: center; }
    .evertune-logo { width: 136px; height: 32px; display: block; }
    .btn-nav-primary {
      background-color: var(--brand-coral);
      border: none; border-radius: 50px;
      padding: 10px 24px; font-weight: 500;
      font-family: 'DM Sans', sans-serif;
      color: white; text-decoration: none;
      transition: all 0.3s ease;
    }
    .btn-nav-primary:hover {
      background-color: #e04a40;
      transform: translateY(-2px);
      box-shadow: 0 8px 18px rgba(247,89,78,0.3);
      color: white;
    }
    .hamburger-menu {
      background: none; border: none;
      font-size: 1.8rem; color: var(--deep-black);
      padding: 5px 10px; display: flex;
      align-items: center; justify-content: center; cursor: pointer;
    }

    /* ===== profile overlay ===== */
    .profile-overlay {
      position: fixed; top: 0; left: 0;
      width: 100%; height: 100%;
      backdrop-filter: blur(8px);
      -webkit-backdrop-filter: blur(8px);
      background-color: rgba(0,0,0,0.3);
      z-index: 1031; display: none;
    }
    .profile-overlay.show { display: block; }

    /* ===== profile modal ===== */
    .profile-modal {
      position: fixed; top: 0; left: 0;
      width: 100%; height: 100%;
      display: flex; align-items: flex-start; justify-content: center;
      z-index: 1032; visibility: hidden; opacity: 0;
      transition: visibility 0.3s, opacity 0.3s;
      padding-top: 70px; overflow-y: auto;
    }
    .profile-modal.show { visibility: visible; opacity: 1; }
    .profile-modal-content {
      background: var(--pure-white);
      border-radius: 0 0 20px 20px;
      box-shadow: 0 20px 60px rgba(0,0,0,0.3);
      width: 100%; max-width: 900px;
      max-height: calc(100vh - 70px);
      overflow-y: auto;
      transform: translateY(-100%);
      transition: transform 0.4s ease;
      position: relative;
    }
    .profile-modal.show .profile-modal-content { transform: translateY(0); }
    .profile-modal-header {
      padding: 22px 28px;
      background: linear-gradient(135deg, var(--cream-peach) 0%, var(--warm-beige) 100%);
      border-radius: 0 0 20px 20px;
      display: flex; align-items: center; justify-content: space-between;
      position: sticky; top: 0; z-index: 10;
    }
    .profile-modal-header .evertune-logo { width: 140px; height: 33px; }
    .profile-modal-close {
      background: none; border: none; font-size: 1.9rem;
      color: var(--deep-black); cursor: pointer;
      width: 40px; height: 40px; display: flex;
      align-items: center; justify-content: center;
      border-radius: 50%; transition: all 0.3s ease; flex-shrink: 0;
    }
    .profile-modal-close:hover { background-color: rgba(27,27,27,0.1); transform: rotate(90deg); }
    .profile-modal-body { padding: 28px; }

    /* user info cards */
    .user-info-grid {
      display: grid; grid-template-columns: repeat(3, 1fr);
      gap: 16px; margin-bottom: 28px; padding-bottom: 28px;
      border-bottom: 1px solid rgba(0,0,0,0.1);
    }
    .info-card {
      background: linear-gradient(135deg, var(--cream-peach) 0%, var(--off-white) 100%);
      border-radius: 12px; padding: 18px 14px;
      text-align: center; box-shadow: var(--card-shadow);
    }
    .info-label  { font-size: 0.85rem; color: var(--gray-medium); margin-bottom: 7px; line-height: 1.3; }
    .info-value  { font-size: 1.2rem; font-weight: 700; color: var(--deep-black); word-break: break-all; }

    /* profile links */
    .profile-links-section { margin-bottom: 20px; }
    .profile-section-title {
      font-size: 1.2rem; font-weight: 600; color: var(--brand-coral);
      margin-bottom: 18px; padding-left: 10px;
      border-left: 4px solid var(--brand-coral);
      cursor: pointer; display: flex; align-items: center; gap: 10px;
      transition: color 0.3s ease;
    }
    .profile-section-title:hover { color: #e04a40; }
    .profile-section-title i { font-size: 1rem; transition: transform 0.3s ease; }
    .profile-section-title.active i { transform: rotate(180deg); }
    .profile-links-grid {
      display: grid; grid-template-columns: repeat(4, 1fr);
      gap: 14px; max-height: 0; overflow: hidden;
      transition: max-height 0.5s ease;
    }
    .profile-links-grid.show { max-height: 600px; }
    .profile-link-item {
      background: var(--off-white);
      border: 1px solid rgba(0,0,0,0.05); border-radius: 10px;
      padding: 10px; text-align: center; text-decoration: none;
      color: var(--deep-black); font-weight: 500; font-size: 0.85rem;
      transition: all 0.3s ease; display: flex;
      flex-direction: column; align-items: center; gap: 8px;
    }
    .profile-link-item i { font-size: 1.4rem; color: var(--brand-coral); }
    .profile-link-item:hover {
      background: var(--brand-coral); color: var(--pure-white);
      transform: translateY(-4px);
      box-shadow: 0 8px 18px rgba(247,89,78,0.3);
    }
    .profile-link-item:hover i { color: var(--pure-white); }
    .profile-link-item.logout { background: rgba(247,89,78,0.1); border-color: var(--brand-coral); }
    .profile-link-item.logout:hover { background: var(--brand-coral); }

    /* ===== main page container ===== */
    .page-container {
      max-width: 560px; width: 90%;
      margin: 2rem auto;
    }

    /* ===== balance card ===== */
    .balance-card {
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      border-radius: 20px; padding: 28px 24px;
      margin-bottom: 1.5rem;
      box-shadow: 0 12px 30px rgba(102,126,234,0.35);
      position: relative; overflow: hidden;
    }
    .balance-card::before {
      content: '';
      position: absolute; top: -40px; right: -40px;
      width: 160px; height: 160px;
      background: rgba(255,255,255,0.1);
      border-radius: 50%;
    }
    .balance-card::after {
      content: '';
      position: absolute; bottom: -60px; right: 40px;
      width: 200px; height: 200px;
      background: rgba(255,255,255,0.07);
      border-radius: 50%;
    }
    .balance-label {
      font-size: 0.9rem; font-weight: 600;
      color: rgba(255,255,255,0.85);
      letter-spacing: 0.05em; margin-bottom: 6px;
    }
    .balance-label, .balance-amount, .balance-note { color: white !important; }
    .balance-amount {
      font-family: 'Montserrat', sans-serif;
      font-size: 2.6rem; font-weight: 700;
      line-height: 1.1; margin-bottom: 10px;
    }
    .balance-note { font-size: 0.82rem; opacity: 0.8; }

    /* ===== form card ===== */
    .form-card {
      background: white; border-radius: 20px;
      box-shadow: 0 20px 40px rgba(0,0,0,0.1);
      border: 1px solid rgba(255,255,255,0.3);
      overflow: hidden;
    }

    /* ===== tab navigation - only history tab ===== */
    .tab-nav {
      display: flex; border-bottom: 2px solid #f1f1f1;
    }
    .tab-btn {
      flex: 1; padding: 16px 12px;
      background: none; border: none;
      font-weight: 600; font-size: 0.95rem;
      color: var(--gray-medium); cursor: pointer;
      position: relative; transition: color 0.3s ease;
      border-bottom: 3px solid transparent;
      margin-bottom: -2px;
    }
    .tab-btn.active { 
      color: var(--brand-coral); 
      border-bottom-color: var(--brand-coral); 
    }

    /* ===== tab panels ===== */
    .tab-panel { display: none; padding: 28px; }
    .tab-panel.active { display: block; }

    /* ===== history sub-tabs ===== */
    .sub-tab-nav {
      display: flex; gap: 8px;
      margin-bottom: 20px; flex-wrap: wrap;
    }
    .sub-tab-btn {
      padding: 8px 20px; border-radius: 50px;
      border: 1.5px solid #e5e7eb;
      background: white; font-weight: 600;
      font-size: 0.82rem; cursor: pointer;
      transition: all 0.25s ease; color: var(--gray-medium);
    }
    .sub-tab-btn.active {
      background: var(--brand-coral);
      border-color: var(--brand-coral);
      color: white;
    }
    .sub-tab-btn:hover:not(.active) {
      border-color: var(--brand-coral);
      color: var(--brand-coral);
    }

    /* history sub-panels */
    .sub-panel { display: none; }
    .sub-panel.active { display: block; }

    /* transaction cards */
    .tx-empty {
      text-align: center; padding: 48px 20px;
      color: var(--gray-medium);
    }
    .tx-empty i { 
      font-size: 3rem; 
      opacity: 0.3; 
      display: block; 
      margin-bottom: 12px;
      color: var(--brand-coral);
    }
    .tx-empty span { font-size: 0.9rem; }

    .tx-card {
      background: #fafafa; border-radius: 14px;
      border: 1px solid #f0f0f0;
      padding: 18px 20px; margin-bottom: 14px;
      transition: box-shadow 0.2s ease;
    }
    .tx-card:hover { box-shadow: var(--card-shadow); }
    .tx-card-header {
      display: flex; align-items: center;
      justify-content: space-between; margin-bottom: 12px;
    }
    .tx-name { font-weight: 700; font-size: 1rem; }
    .tx-badge {
      font-size: 0.75rem; font-weight: 700;
      padding: 4px 12px; border-radius: 50px;
      letter-spacing: 0.03em;
    }
    .badge-reviewing { background: #fff3cd; color: #856404; }
    .badge-success   { background: #d1fae5; color: #065f46; }
    .badge-rejected  { background: #fee2e2; color: #991b1b; }
    .badge-pending   { background: #bee3f8; color: #2c5282; }
    .tx-row {
      display: flex; justify-content: space-between;
      align-items: center; padding: 5px 0;
      border-bottom: 1px dashed #ebebeb; font-size: 0.85rem;
    }
    .tx-row:last-child { border-bottom: none; padding-bottom: 0; }
    .tx-row-label { color: var(--gray-medium); font-weight: 500; }
    .tx-row-value { font-weight: 600; text-align: right; max-width: 60%; word-break: break-all; }
    .tx-amount { color: var(--brand-coral); }
    .tx-id { 
      font-size: 0.7rem; 
      color: var(--gray-medium);
      background: #f0f0f0;
      padding: 2px 8px;
      border-radius: 50px;
    }

    /* ===== alert / flash message ===== */
    .flash-message {
      position: fixed; top: 50%; left: 50%;
      transform: translate(-50%, -50%);
      background: rgba(27,27,27,0.88);
      backdrop-filter: blur(8px);
      color: white; padding: 20px 32px;
      border-radius: 14px; font-size: 1rem;
      font-weight: 600; text-align: center;
      z-index: 9999; min-width: 240px;
      box-shadow: 0 8px 32px rgba(0,0,0,0.3);
    }

    /* ===== footer ===== */
    .footer-note {
      text-align: center; color: var(--deep-black);
      opacity: 0.7; font-size: 0.85rem;
      margin-top: 2rem;
    }

    /* ===== responsive modal ===== */
    @media (max-width: 992px) {
      .profile-modal-content { max-width: 96%; }
      .user-info-grid { grid-template-columns: repeat(3,1fr); gap: 14px; }
      .profile-links-grid { grid-template-columns: repeat(3,1fr); }
    }
    @media (max-width: 768px) {
      .navbar { height: 60px; padding: 10px 0; }
      body { padding-top: 60px; }
      .profile-modal { padding-top: 60px; }
      .profile-modal-content { max-width: 100%; border-radius: 0 0 16px 16px; max-height: calc(100vh - 60px); }
      .profile-modal-header { padding: 14px 18px; }
      .profile-modal-header .evertune-logo { width: 110px; height: 26px; }
      .profile-modal-body { padding: 18px; }
      .user-info-grid { grid-template-columns: repeat(2,1fr); gap: 12px; margin-bottom: 20px; padding-bottom: 20px; }
      .info-card { padding: 14px 10px; }
      .info-label { font-size: 0.75rem; }
      .info-value { font-size: 1rem; }
      .profile-links-grid { grid-template-columns: repeat(3,1fr); gap: 10px; }
      .profile-link-item { padding: 12px 8px; font-size: 0.78rem; }
      .profile-link-item i { font-size: 1.3rem; }
      .evertune-logo { width: 100px; height: 24px; }
      .btn-nav-primary { padding: 8px 16px; font-size: 0.9rem; }
      .balance-amount { font-size: 2rem; }
      .tab-panel { padding: 20px; }
    }
    @media (max-width: 576px) {
      .profile-modal-body { padding: 14px; }
      .profile-modal-header { padding: 12px 14px; }
      .profile-modal-header .evertune-logo { width: 95px; height: 22px; }
      .user-info-grid { grid-template-columns: repeat(2,1fr); gap: 10px; }
      .info-card { padding: 12px 8px; border-radius: 10px; }
      .info-label { font-size: 0.7rem; }
      .info-value { font-size: 0.9rem; }
      .profile-section-title { font-size: 1rem; }
      .profile-links-grid { grid-template-columns: repeat(2,1fr); gap: 10px; }
      .profile-link-item { padding: 10px 8px; font-size: 0.8rem; border-radius: 10px; }
      .balance-amount { font-size: 1.8rem; }
    }
    @media (max-width: 400px) {
      .user-info-grid { grid-template-columns: 1fr 1fr; gap: 8px; }
      .info-value { font-size: 0.85rem; }
      .profile-links-grid { grid-template-columns: repeat(2,1fr); gap: 8px; }
      .profile-link-item { padding: 12px 6px; font-size: 0.75rem; }
      .profile-modal-header .evertune-logo { width: 85px; height: 20px; }
    }
  </style>
</head>
<body>

  <!-- ========== FLASH MESSAGE ========== -->
  <% if (message) { %>
    <div class="flash-message" id="flashMessage">
      <%= message %>
    </div>
  <% } %>
  
  <% if (error) { %>
    <div class="flash-message" id="flashMessage" style="background: rgba(220,38,38,0.9);">
      <%= error %>
    </div>
  <% } %>

  <!-- ========== TOP NAVBAR ========== -->
  <nav class="navbar">
    <div class="navbar-container">
      <div class="navbar-left">
        <div class="logo-wrapper">
          <svg class="evertune-logo" viewBox="0 0 136 32" fill="none" xmlns="http://www.w3.org/2000/svg">
            <path d="M0.132268 29.32C-0.16107 28.0008 0.0842353 26.7314 0.375858 25.51C0.864755 23.2148 1.69502 21.0173 2.47554 18.8182L3.11025 17.0598C2.71913 16.9621 2.32801 16.914 1.98664 16.7665C1.25416 16.3754 1.20441 15.4473 1.93861 15.0082C2.47554 14.7149 3.06222 14.5193 3.64718 14.3237C4.08633 14.1779 4.37967 13.9824 4.57523 13.5415L7.50518 7.1927C7.60296 7.04689 7.65099 6.85134 7.45714 6.70381C7.35936 6.65578 7.11578 6.60603 6.96825 6.65578C5.89439 7.0469 4.67301 7.14467 3.69521 7.87716C3.5494 7.97494 3.25606 8.02297 3.01076 8.02297C2.52186 8.02297 2.18049 7.77938 1.98493 7.38826C1.83912 6.99715 1.9369 6.50997 2.22852 6.16688C2.71742 5.67798 3.35213 5.43439 3.98683 5.23883C5.35403 4.79968 6.6732 4.36053 8.04039 4.01745C8.62707 3.87164 9.11425 3.72411 9.35956 3.13915C9.65289 2.50444 10.1898 2.30888 10.7268 2.60222C11.7028 3.09112 12.5828 2.84581 13.5589 2.60222L23.1808 0.159447C23.5221 0.0616675 23.8652 -0.0841399 24.2546 0.0616715C24.6457 0.25723 25.0849 0.452788 25.1329 0.93997C25.1809 1.42715 24.7915 1.67246 24.3507 1.81827C23.7160 2.06186 23.1293 2.30716 22.4466 2.50272C19.3210 3.33299 16.1955 4.16326 13.0683 5.04327L11.9945 5.33661C11.6531 5.43439 11.3597 5.67798 11.2122 6.02107L8.38004 12.713C9.01475 12.9565 9.40587 12.761 9.84502 12.6649C12.1403 12.0782 14.4853 11.5413 16.7805 10.9564C17.4152 10.7608 18.0019 10.8105 18.5388 11.1519C18.9780 11.4933 18.978 12.08 18.5388 12.4213C18.1477 12.6649 17.7566 12.7627 17.3174 12.8605C14.3875 13.6907 11.4558 14.5708 8.47783 15.3032C7.50175 15.5468 6.86532 15.9877 6.52395 16.9638C5.35232 20.2849 4.08118 23.5081 3.34869 26.927C3.20288 27.5617 3.10511 28.1484 3.20288 28.7831C3.25092 29.1742 3.49622 29.4178 3.93537 29.4178C4.86342 29.4178 5.74172 29.1245 6.66976 28.8809C9.25834 28.1964 11.7491 27.2203 14.0941 25.8034C14.7288 25.4123 15.3636 25.1189 16.1938 25.3145C16.5352 25.4123 16.8783 25.6078 17.0241 25.9492C17.2196 26.4381 16.9761 26.7795 16.6330 27.1208C16.4374 27.3164 16.1441 27.4622 15.9005 27.6578C12.8230 29.7574 9.40416 31.1246 5.78975 31.8588C4.95948 32.0544 4.08118 32.0047 3.20117 31.9566C1.54063 31.8588 0.514808 30.9805 0.12369 29.32H0.132268Z" fill="#F7594E"/>
          </svg>
        </div>
      </div>
      <div class="navbar-right">
        <a href="/start-page" class="btn-nav-primary">Start Work</a>
        <div class="profile-dropdown">
          <button class="hamburger-menu" id="profileMenuToggle">
            <i class="bi bi-list"></i>
          </button>
        </div>
      </div>
    </div>
  </nav>

  <!-- Blur Overlay -->
  <div class="profile-overlay" id="profileOverlay"></div>

  <!-- Profile Modal -->
  <div class="profile-modal" id="profileModal">
    <div class="profile-modal-content">
      <div class="profile-modal-header">
        <svg class="evertune-logo" viewBox="0 0 136 32" fill="none" xmlns="http://www.w3.org/2000/svg">
          <path d="M0.132268 29.32C-0.16107 28.0008 0.0842353 26.7314 0.375858 25.51C0.864755 23.2148 1.69502 21.0173 2.47554 18.8182L3.11025 17.0598C2.71913 16.9621 2.32801 16.914 1.98664 16.7665C1.25416 16.3754 1.20441 15.4473 1.93861 15.0082C2.47554 14.7149 3.06222 14.5193 3.64718 14.3237C4.08633 14.1779 4.37967 13.9824 4.57523 13.5415L7.50518 7.1927C7.60296 7.04689 7.65099 6.85134 7.45714 6.70381C7.35936 6.65578 7.11578 6.60603 6.96825 6.65578C5.89439 7.0469 4.67301 7.14467 3.69521 7.87716C3.5494 7.97494 3.25606 8.02297 3.01076 8.02297C2.52186 8.02297 2.18049 7.77938 1.98493 7.38826C1.83912 6.99715 1.9369 6.50997 2.22852 6.16688C2.71742 5.67798 3.35213 5.43439 3.98683 5.23883C5.35403 4.79968 6.6732 4.36053 8.04039 4.01745C8.62707 3.87164 9.11425 3.72411 9.35956 3.13915C9.65289 2.50444 10.1898 2.30888 10.7268 2.60222C11.7028 3.09112 12.5828 2.84581 13.5589 2.60222L23.1808 0.159447C23.5221 0.0616675 23.8652 -0.0841399 24.2546 0.0616715C24.6457 0.25723 25.0849 0.452788 25.1329 0.93997C25.1809 1.42715 24.7915 1.67246 24.3507 1.81827C23.7160 2.06186 23.1293 2.30716 22.4466 2.50272C19.3210 3.33299 16.1955 4.16326 13.0683 5.04327L11.9945 5.33661C11.6531 5.43439 11.3597 5.67798 11.2122 6.02107L8.38004 12.713C9.01475 12.9565 9.40587 12.761 9.84502 12.6649C12.1403 12.0782 14.4853 11.5413 16.7805 10.9564C17.4152 10.7608 18.0019 10.8105 18.5388 11.1519C18.9780 11.4933 18.978 12.08 18.5388 12.4213C18.1477 12.6649 17.7566 12.7627 17.3174 12.8605C14.3875 13.6907 11.4558 14.5708 8.47783 15.3032C7.50175 15.5468 6.86532 15.9877 6.52395 16.9638C5.35232 20.2849 4.08118 23.5081 3.34869 26.927C3.20288 27.5617 3.10511 28.1484 3.20288 28.7831C3.25092 29.1742 3.49622 29.4178 3.93537 29.4178C4.86342 29.4178 5.74172 29.1245 6.66976 28.8809C9.25834 28.1964 11.7491 27.2203 14.0941 25.8034C14.7288 25.4123 15.3636 25.1189 16.1938 25.3145C16.5352 25.4123 16.8783 25.6078 17.0241 25.9492C17.2196 26.4381 16.9761 26.7795 16.6330 27.1208C16.4374 27.3164 16.1441 27.4622 15.9005 27.6578C12.8230 29.7574 9.40416 31.1246 5.78975 31.8588C4.95948 32.0544 4.08118 32.0047 3.20117 31.9566C1.54063 31.8588 0.514808 30.9805 0.12369 29.32H0.132268Z" fill="#F7594E"/>
        </svg>
        <button class="profile-modal-close" id="closeProfileModal">
          <i class="bi bi-x-lg"></i>
        </button>
      </div>

      <div class="profile-modal-body">
        <div class="user-info-grid">
          <div class="info-card">
            <div class="info-label">Username</div>
            <div class="info-value" id="user-username">Loading...</div>
          </div>
          <div class="info-card">
            <div class="info-label">Wallet Balance</div>
            <div class="info-value" id="user-wallet">0.00 USD</div>
          </div>
          <div class="info-card">
            <div class="info-label">VIP Level</div>
            <div class="info-value" id="user-vip">VIP1</div>
          </div>
          <div class="info-card">
            <div class="info-label">Invitation Code</div>
            <div class="info-value" id="user-invitation-code">Loading...</div>
          </div>
          <div class="info-card">
            <div class="info-label">Today's Commission</div>
            <div class="info-value" id="user-commission">0.00 USD</div>
          </div>
          <div class="info-card">
            <div class="info-label">Today's Reward</div>
            <div class="info-value" id="user-reward">0.00 USD</div>
          </div>
        </div>

        <div class="profile-links-section">
          <div class="profile-section-title" id="profileLinksToggle">
            <span>Profile</span>
            <i class="bi bi-chevron-down"></i>
          </div>
          <div class="profile-links-grid" id="profileLinksGrid">
            <a href="/deposit" class="profile-link-item"><i class="bi bi-clock-history"></i><span>Deposit History</span></a>
            <a href="/link-wallet" class="profile-link-item"><i class="bi bi-wallet2"></i><span>My Wallet</span></a>
            <a href="/withdraw" class="profile-link-item"><i class="bi bi-cash-stack"></i><span>Withdraw</span></a>
            <a href="/change-withdrawal-password" class="profile-link-item"><i class="bi bi-shield-lock"></i><span>Change Withdrawal Password</span></a>
            <a href="/vip-levels" class="profile-link-item"><i class="bi bi-star"></i><span>VIP Level</span></a>
            <a href="/salary" class="profile-link-item"><i class="bi bi-currency-dollar"></i><span>Salary</span></a>
            <a href="/certificates" class="profile-link-item"><i class="bi bi-patch-check"></i><span>Certificates</span></a>
            <a href="/faq" class="profile-link-item"><i class="bi bi-question-circle"></i><span>FAQs</span></a>
            <a href="/terms" class="profile-link-item"><i class="bi bi-file-text"></i><span>T & C</span></a>
            <a href="/reset-bonus" class="profile-link-item"><i class="bi bi-arrow-repeat"></i><span>Reset Bonus</span></a>
            <a href="/contact" class="profile-link-item"><i class="bi bi-envelope"></i><span>Contact</span></a>
            <a href="#" onclick="logout()" class="profile-link-item logout"><i class="bi bi-box-arrow-right"></i><span>Logout</span></a>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- ========== MAIN CONTENT ========== -->
  <div class="page-container">

    <!-- Balance Card -->
    <div class="balance-card">
      <div class="balance-label">TOTAL DEPOSITS</div>
      <div class="balance-amount"><%= totalDeposits.toFixed(2) %> <span style="font-size:1.2rem;opacity:0.85;">USDC</span></div>
      <div class="balance-note"><i class="bi bi-clock" style="margin-right:5px;"></i>Deposits are processed by admin</div>
    </div>

    <!-- History Card -->
    <div class="form-card">
      <div class="tab-nav">
        <button class="tab-btn active" data-tab="history">
          <i class="bi bi-clock-history" style="margin-right:6px;"></i>Deposit History
        </button>
      </div>

      <!-- ===== HISTORY TAB ===== -->
      <div class="tab-panel active" id="tab-history">
        <div class="sub-tab-nav">
          <button class="sub-tab-btn active" data-sub="reviewing">Reviewing</button>
          <button class="sub-tab-btn" data-sub="success">Success</button>
          <button class="sub-tab-btn" data-sub="rejected">Rejected</button>
          <button class="sub-tab-btn" data-sub="pending">Pending</button>
        </div>

        <!-- Reviewing Deposits -->
        <div class="sub-panel active" id="sub-reviewing">
          <% if (reviewing.length === 0) { %>
            <div class="tx-empty">
              <i class="bi bi-hourglass-split"></i>
              <span>No deposits under review</span>
            </div>
          <% } else { %>
            <% reviewing.sort((a, b) => new Date(b.createdAt) - new Date(a.createdAt)); %>
            <% reviewing.forEach(item => { %>
              <div class="tx-card">
                <div class="tx-card-header">
                  <span class="tx-name">Deposit #<%= item.transactionId %></span>
                  <span class="tx-badge badge-reviewing">Reviewing</span>
                </div>
                <div class="tx-row">
                  <span class="tx-row-label">Amount</span>
                  <span class="tx-row-value tx-amount"><%= item.amount.toFixed(2) %> USDC</span>
                </div>
                <div class="tx-row">
                  <span class="tx-row-label">Payment Method</span>
                  <span class="tx-row-value"><%= item.paymentMethod %></span>
                </div>
                <% if (item.description) { %>
                <div class="tx-row">
                  <span class="tx-row-label">Description</span>
                  <span class="tx-row-value"><%= item.description %></span>
                </div>
                <% } %>
                <div class="tx-row">
                  <span class="tx-row-label">Date</span>
                  <span class="tx-row-value"><%= new Date(item.createdAt).toLocaleString() %></span>
                </div>
                <% if (item.notes) { %>
                <div class="tx-row">
                  <span class="tx-row-label">Notes</span>
                  <span class="tx-row-value"><%= item.notes %></span>
                </div>
                <% } %>
              </div>
            <% }) %>
          <% } %>
        </div>

        <!-- Success Deposits -->
        <div class="sub-panel" id="sub-success">
          <% if (success.length === 0) { %>
            <div class="tx-empty">
              <i class="bi bi-check-circle"></i>
              <span>No successful deposits yet</span>
            </div>
          <% } else { %>
            <% success.sort((a, b) => new Date(b.createdAt) - new Date(a.createdAt)); %>
            <% success.forEach(item => { %>
              <div class="tx-card">
                <div class="tx-card-header">
                  <span class="tx-name">Deposit #<%= item.transactionId %></span>
                  <span class="tx-badge badge-success">Success</span>
                </div>
                <div class="tx-row">
                  <span class="tx-row-label">Amount</span>
                  <span class="tx-row-value tx-amount"><%= item.amount.toFixed(2) %> USDC</span>
                </div>
                <div class="tx-row">
                  <span class="tx-row-label">Payment Method</span>
                  <span class="tx-row-value"><%= item.paymentMethod %></span>
                </div>
                <% if (item.description) { %>
                <div class="tx-row">
                  <span class="tx-row-label">Description</span>
                  <span class="tx-row-value"><%= item.description %></span>
                </div>
                <% } %>
                <div class="tx-row">
                  <span class="tx-row-label">Date</span>
                  <span class="tx-row-value"><%= new Date(item.createdAt).toLocaleString() %></span>
                </div>
                <% if (item.notes) { %>
                <div class="tx-row">
                  <span class="tx-row-label">Notes</span>
                  <span class="tx-row-value"><%= item.notes %></span>
                </div>
                <% } %>
              </div>
            <% }) %>
          <% } %>
        </div>

        <!-- Rejected Deposits -->
        <div class="sub-panel" id="sub-rejected">
          <% if (rejected.length === 0) { %>
            <div class="tx-empty">
              <i class="bi bi-x-circle"></i>
              <span>No rejected deposits</span>
            </div>
          <% } else { %>
            <% rejected.sort((a, b) => new Date(b.createdAt) - new Date(a.createdAt)); %>
            <% rejected.forEach(item => { %>
              <div class="tx-card">
                <div class="tx-card-header">
                  <span class="tx-name">Deposit #<%= item.transactionId %></span>
                  <span class="tx-badge badge-rejected">Rejected</span>
                </div>
                <div class="tx-row">
                  <span class="tx-row-label">Amount</span>
                  <span class="tx-row-value tx-amount"><%= item.amount.toFixed(2) %> USDC</span>
                </div>
                <div class="tx-row">
                  <span class="tx-row-label">Payment Method</span>
                  <span class="tx-row-value"><%= item.paymentMethod %></span>
                </div>
                <% if (item.description) { %>
                <div class="tx-row">
                  <span class="tx-row-label">Description</span>
                  <span class="tx-row-value"><%= item.description %></span>
                </div>
                <% } %>
                <div class="tx-row">
                  <span class="tx-row-label">Date</span>
                  <span class="tx-row-value"><%= new Date(item.createdAt).toLocaleString() %></span>
                </div>
                <% if (item.notes) { %>
                <div class="tx-row">
                  <span class="tx-row-label">Notes</span>
                  <span class="tx-row-value"><%= item.notes %></span>
                </div>
                <% } %>
              </div>
            <% }) %>
          <% } %>
        </div>

        <!-- Pending Deposits -->
        <div class="sub-panel" id="sub-pending">
          <% if (pending.length === 0) { %>
            <div class="tx-empty">
              <i class="bi bi-clock"></i>
              <span>No pending deposits</span>
            </div>
          <% } else { %>
            <% pending.sort((a, b) => new Date(b.createdAt) - new Date(a.createdAt)); %>
            <% pending.forEach(item => { %>
              <div class="tx-card">
                <div class="tx-card-header">
                  <span class="tx-name">Deposit #<%= item.transactionId %></span>
                  <span class="tx-badge badge-pending">Pending</span>
                </div>
                <div class="tx-row">
                  <span class="tx-row-label">Amount</span>
                  <span class="tx-row-value tx-amount"><%= item.amount.toFixed(2) %> USDC</span>
                </div>
                <div class="tx-row">
                  <span class="tx-row-label">Payment Method</span>
                  <span class="tx-row-value"><%= item.paymentMethod %></span>
                </div>
                <% if (item.description) { %>
                <div class="tx-row">
                  <span class="tx-row-label">Description</span>
                  <span class="tx-row-value"><%= item.description %></span>
                </div>
                <% } %>
                <div class="tx-row">
                  <span class="tx-row-label">Date</span>
                  <span class="tx-row-value"><%= new Date(item.createdAt).toLocaleString() %></span>
                </div>
                <% if (item.notes) { %>
                <div class="tx-row">
                  <span class="tx-row-label">Notes</span>
                  <span class="tx-row-value"><%= item.notes %></span>
                </div>
                <% } %>
              </div>
            <% }) %>
          <% } %>
        </div>

      </div><!-- /tab-history -->
    </div><!-- /form-card -->
  </div><!-- /page-container -->

  <div class="footer-note">© Evertune. All Rights Reserved.</div>

  <script>
    // ========== FLASH MESSAGE AUTO-DISMISS ==========
    document.addEventListener('DOMContentLoaded', () => {
      const flash = document.getElementById('flashMessage');
      if (flash) {
        setTimeout(() => {
          flash.style.transition = 'opacity 0.5s';
          flash.style.opacity = '0';
          setTimeout(() => flash.remove(), 500);
        }, 3000);
      }
    });

    // ========== SUB TABS ==========
    document.querySelectorAll('.sub-tab-btn').forEach(btn => {
      btn.addEventListener('click', () => {
        document.querySelectorAll('.sub-tab-btn').forEach(b => b.classList.remove('active'));
        document.querySelectorAll('.sub-panel').forEach(p => p.classList.remove('active'));
        btn.classList.add('active');
        document.getElementById('sub-' + btn.dataset.sub).classList.add('active');
      });
    });

    // ========== PROFILE MODAL ==========
    function initProfileModal() {
      const toggle   = document.getElementById('profileMenuToggle');
      const closeBtn = document.getElementById('closeProfileModal');
      const modal    = document.getElementById('profileModal');
      const overlay  = document.getElementById('profileOverlay');
      const linksToggle = document.getElementById('profileLinksToggle');
      const linksGrid   = document.getElementById('profileLinksGrid');

      toggle.addEventListener('click', e => {
        e.stopPropagation();
        modal.classList.add('show');
        overlay.classList.add('show');
        document.body.style.overflow = 'hidden';
        setTimeout(() => {
          linksGrid.classList.add('show');
          linksToggle.classList.add('active');
        }, 300);
      });

      closeBtn.addEventListener('click', closeModal);
      overlay.addEventListener('click', closeModal);
      
      linksToggle.addEventListener('click', () => {
        linksToggle.classList.toggle('active');
        linksGrid.classList.toggle('show');
      });
      
      document.addEventListener('keydown', e => {
        if (e.key === 'Escape' && modal.classList.contains('show')) closeModal();
      });
    }

    function closeModal() {
      document.getElementById('profileModal').classList.remove('show');
      document.getElementById('profileOverlay').classList.remove('show');
      document.body.style.overflow = '';
      document.getElementById('profileLinksGrid').classList.remove('show');
      document.getElementById('profileLinksToggle').classList.remove('active');
    }

    // ========== FETCH USER DATA FOR PROFILE MODAL ==========
    async function fetchUserData() {
      try {
        const response = await fetch('/api/user/complete-profile');
        if (!response.ok) throw new Error(`HTTP error! status: ${response.status}`);
        const result = await response.json();
        if (result.success) updateUserUI(result.data);
        else throw new Error(result.error || 'Failed to fetch user data');
      } catch (error) {
        console.error('Error fetching user data:', error);
        useFallbackData();
      }
    }

    function updateUserUI(data) {
      const set = (id, val) => { const el = document.getElementById(id); if (el) el.textContent = val; };
      set('user-username',        data.username       || 'User');
      set('user-wallet',          `${parseFloat(data.totalBalance  || 0).toFixed(2)} USD`);
      set('user-vip',             data.vipLevel       || 'VIP1');
      set('user-invitation-code', data.invitationCode || 'N/A');
      set('user-commission',      `${parseFloat(data.todaysProfit  || 0).toFixed(2)} USD`);
      set('user-reward',          `${parseFloat(data.todaysProfit  || 0).toFixed(2)} USD`);
    }

    function useFallbackData() {
      const set = (id, val) => { const el = document.getElementById(id); if (el) el.textContent = val; };
      set('user-username', 'User'); set('user-wallet', '0.00 USD');
      set('user-vip', 'VIP1');     set('user-invitation-code', 'N/A');
      set('user-commission', '0.00 USD'); set('user-reward', '0.00 USD');
    }

    function logout() {
      if (confirm('Are you sure you want to logout?')) {
        fetch('/api/logout', { method: 'POST', headers: { 'Content-Type': 'application/json' } })
          .then(r => r.json())
          .then(data => { if (data.success) window.location.href = '/?auth=login&message=' + encodeURIComponent('Logged out successfully'); })
          .catch(err => { console.error('Logout error:', err); alert('Logout failed. Please try again.'); });
      }
    }

    document.addEventListener('DOMContentLoaded', () => {
      initProfileModal();
      fetchUserData();
    });
  </script>
</body>
</html>