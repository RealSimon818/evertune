<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Reset Password | Evertune.ai</title>
    <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@300;400;500;600;700&family=Manrope:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        :root {
            --primary-coral: #F7594E;
            --pure-white: #FFFFFF;
            --deep-black: #1B1B1B;
            --cream-peach: #FFF9F6;
            --teal-turquoise: #69D7DE;
            --warm-beige: #F9DCB7;
            --off-white: #FDFEFE;
            --medium-gray: #6B7280;
            --light-gray: #F3F4F6;
            --shadow-soft: 0 4px 14px rgba(0, 0, 0, 0.08);
            --shadow-medium: 0 10px 25px rgba(0, 0, 0, 0.1);
            --shadow-large: 0 20px 40px rgba(0, 0, 0, 0.12);
            --transition-normal: 0.3s ease;
            --transition-fast: 0.2s ease;
        }

        body {
            font-family: 'Manrope', sans-serif;
            background: linear-gradient(135deg, #FFF9F6 0%, #FFFFFF 50%, #F3F4F6 100%);
            min-height: 100vh;
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 20px;
            color: var(--deep-black);
            line-height: 1.6;
        }

        .reset-container {
            width: 100%;
            max-width: 500px;
            background: var(--pure-white);
            border-radius: 24px;
            overflow: hidden;
            box-shadow: var(--shadow-large);
            padding: 50px;
            position: relative;
        }

        /* Logo */
        .logo-container {
            text-align: center;
            margin-bottom: 40px;
        }

        .logo {
            display: inline-flex;
            align-items: center;
            gap: 0;
            text-decoration: none;
        }

        .logo svg {
            width: 136px;
            height: auto;
        }

        /* Back Button */
        .back-btn {
            position: absolute;
            top: 30px;
            left: 30px;
            background: none;
            border: none;
            color: var(--medium-gray);
            cursor: pointer;
            font-size: 16px;
            display: flex;
            align-items: center;
            gap: 8px;
            transition: color var(--transition-fast);
        }

        .back-btn:hover {
            color: var(--primary-coral);
        }

        /* Header */
        .form-header {
            text-align: center;
            margin-bottom: 40px;
        }

        .form-title {
            font-family: 'Montserrat', sans-serif;
            font-weight: 700;
            font-size: 34px;
            margin-bottom: 10px;
            color: var(--deep-black);
        }

        .form-subtitle {
            color: var(--medium-gray);
            font-size: 16px;
        }

        /* Form Elements */
        .form-group {
            margin-bottom: 22px;
        }

        .form-label {
            display: block;
            margin-bottom: 10px;
            font-weight: 600;
            color: var(--deep-black);
            font-size: 14px;
        }

        .form-input {
            width: 100%;
            padding: 15px 18px;
            border: 2px solid #E5E7EB;
            border-radius: 12px;
            font-size: 15px;
            font-family: 'Manrope', sans-serif;
            transition: all var(--transition-normal);
            background: var(--pure-white);
            color: var(--deep-black);
        }

        .form-input:hover {
            border-color: #D1D5DB;
        }

        .form-input:focus {
            outline: none;
            border-color: var(--primary-coral);
            box-shadow: 0 0 0 4px rgba(247, 89, 78, 0.1);
        }

        .form-input::placeholder {
            color: #9CA3AF;
        }

        .password-input {
            position: relative;
        }

        .toggle-password {
            position: absolute;
            right: 18px;
            top: 50%;
            transform: translateY(-50%);
            background: none;
            border: none;
            color: var(--medium-gray);
            cursor: pointer;
            font-size: 20px;
            padding: 6px;
            transition: color var(--transition-fast);
            line-height: 1;
        }

        .toggle-password:hover {
            color: var(--primary-coral);
        }

        /* Button */
        .btn {
            width: 100%;
            padding: 17px 24px;
            border: none;
            border-radius: 12px;
            font-family: 'Montserrat', sans-serif;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: all var(--transition-normal);
            margin-top: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
        }

        .btn-primary {
            background: var(--primary-coral);
            color: var(--pure-white);
            box-shadow: 0 4px 14px rgba(247, 89, 78, 0.3);
        }

        .btn-primary:hover:not(:disabled) {
            transform: translateY(-2px);
            box-shadow: 0 8px 20px rgba(247, 89, 78, 0.4);
            background: #E5483D;
        }

        .btn-primary:active:not(:disabled) {
            transform: translateY(0);
        }

        .btn:disabled {
            opacity: 0.6;
            cursor: not-allowed;
            transform: none !important;
            box-shadow: none !important;
        }

        /* Alerts */
        .alert {
            padding: 18px 20px;
            border-radius: 12px;
            margin-bottom: 24px;
            font-size: 14px;
            display: none;
            animation: slideIn 0.3s ease;
            border-left: 4px solid transparent;
            font-weight: 500;
        }

        @keyframes slideIn {
            from { opacity: 0; transform: translateY(-15px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .alert.show {
            display: flex;
            align-items: center;
            justify-content: space-between;
        }

        .alert-success {
            background: #ECFDF5;
            color: #065F46;
            border-left-color: #10B981;
        }

        .alert-error {
            background: #FEF2F2;
            color: #991B1B;
            border-left-color: #EF4444;
        }

        .alert-close {
            background: none;
            border: none;
            color: inherit;
            cursor: pointer;
            font-size: 22px;
            padding: 0 6px;
            opacity: 0.7;
            transition: opacity var(--transition-fast);
            line-height: 1;
        }

        .alert-close:hover {
            opacity: 1;
        }

        /* Loading Animation */
        .loading-spinner {
            display: none;
            width: 20px;
            height: 20px;
            border: 2px solid rgba(255, 255, 255, 0.3);
            border-radius: 50%;
            border-top-color: white;
            animation: spin 0.8s linear infinite;
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }

        .btn.loading .loading-spinner {
            display: inline-block;
        }

        /* Responsive */
        @media (max-width: 576px) {
            .reset-container {
                padding: 30px 25px;
                border-radius: 20px;
            }
            
            .back-btn {
                top: 20px;
                left: 20px;
            }
            
            .form-title {
                font-size: 28px;
            }
            
            .logo svg {
                width: 100px;
            }
        }
    </style>
</head>
<body>
    <div class="reset-container">
        <!-- Back Button -->
        <button class="back-btn" onclick="goBack()">
            ‚Üê Back
        </button>

        <!-- Logo -->
        <div class="logo-container">
            <a href="/" class="logo">
                <svg width="136" height="32" viewBox="0 0 136 32" fill="none" xmlns="http://www.w3.org/2000/svg">
                    <path d="M0.132268 29.32C-0.16107 28.0008 0.0842353 26.7314 0.375858 25.51C0.864755 23.2148 1.69502 21.0173 2.47554 18.8182L3.11025 17.0598C2.71913 16.9621 2.32801 16.914 1.98664 16.7665C1.25416 16.3754 1.20441 15.4473 1.93861 15.0082C2.47554 14.7149 3.06222 14.5193 3.64718 14.3237C4.08633 14.1779 4.37967 13.9824 4.57523 13.5415L7.50518 7.1927C7.60296 7.04689 7.65099 6.85134 7.45714 6.70381C7.35936 6.65578 7.11578 6.60603 6.96825 6.65578C5.89439 7.0469 4.67301 7.14467 3.69521 7.87716C3.5494 7.97494 3.25606 8.02297 3.01076 8.02297C2.52186 8.02297 2.18049 7.77938 1.98493 7.38826C1.83912 6.99715 1.9369 6.50997 2.22852 6.16688C2.71742 5.67798 3.35213 5.43439 3.98683 5.23883C5.35403 4.79968 6.6732 4.36053 8.04039 4.01745C8.62707 3.87164 9.11425 3.72411 9.35956 3.13915C9.65289 2.50444 10.1898 2.30888 10.7268 2.60222C11.7028 3.09112 12.5828 2.84581 13.5589 2.60222L23.1808 0.159447C23.5221 0.0616675 23.8652 -0.0841399 24.2546 0.0616715C24.6457 0.25723 25.0849 0.452788 25.1329 0.93997C25.1809 1.42715 24.7915 1.67246 24.3507 1.81827C23.716 2.06186 23.1293 2.30716 22.4466 2.50272C19.321 3.33299 16.1955 4.16326 13.0683 5.04327L11.9945 5.33661C11.6531 5.43439 11.3597 5.67798 11.2122 6.02107L8.38004 12.713C9.01475 12.9565 9.40587 12.761 9.84502 12.6649C12.1403 12.0782 14.4853 11.5413 16.7805 10.9564C17.4152 10.7608 18.0019 10.8105 18.5388 11.1519C18.978 11.4933 18.978 12.08 18.5388 12.4213C18.1477 12.6649 17.7566 12.7627 17.3174 12.8605C14.3875 13.6907 11.4558 14.5708 8.47783 15.3032C7.50175 15.5468 6.86532 15.9877 6.52395 16.9638C5.35232 20.2849 4.08118 23.5081 3.34869 26.927C3.20288 27.5617 3.10511 28.1484 3.20288 28.7831C3.25092 29.1742 3.49622 29.4178 3.93537 29.4178C4.86342 29.4178 5.74172 29.1245 6.66976 28.8809C9.25834 28.1964 11.7491 27.2203 14.0941 25.8034C14.7288 25.4123 15.3636 25.1189 16.1938 25.3145C16.5352 25.4123 16.8783 25.6078 17.0241 25.9492C17.2196 26.4381 16.9761 26.7795 16.633 27.1208C16.4374 27.3164 16.1441 27.4622 15.9005 27.6578C12.823 29.7574 9.40416 31.1246 5.78975 31.8588C4.95948 32.0544 4.08118 32.0047 3.20117 31.9566C1.54063 31.8588 0.514808 30.9805 0.12369 29.32H0.132268Z" fill="#F7594E"/>
                    <path d="M21.0365 26.8292C21.0846 26.2923 21.1343 25.7056 21.2321 25.1687C21.9646 21.652 23.1362 18.2332 24.1621 14.7663C24.4057 13.9841 24.6012 13.2036 24.8465 12.4711C24.9923 11.8844 25.4332 11.6408 25.9204 11.6888C26.5071 11.7369 26.8965 12.0302 26.9942 12.5671C27.092 13.2018 27.3853 13.8365 26.8484 14.4713C26.6048 14.7646 26.5071 15.2535 26.4093 15.6429C25.9701 17.1079 25.531 18.6226 25.1879 20.0876C24.6012 22.3828 25.7248 20.6245 25.9204 20.3312C27.7765 17.6448 29.5348 14.8607 31.4887 12.3218C31.7322 12.0285 31.9776 11.7351 32.1731 11.4435C32.5642 10.9066 33.0514 10.8088 33.6381 10.9066C34.4684 11.0524 34.7617 11.6391 34.3706 12.3716C34.2728 12.5671 34.127 12.7627 33.9795 12.9582C31.1473 17.1096 28.4609 21.4084 25.8226 25.6576C25.4812 26.1945 25.1381 26.6834 24.7968 27.1723C24.5532 27.5136 24.2598 27.8567 23.9185 28.1484C23.3815 28.6373 22.6971 28.6853 22.0143 28.4417C21.3299 28.1981 20.9885 27.5634 21.0383 26.8292H21.0365Z" fill="#F7594E"/>
                    <path d="M35.1022 26.0968C34.5653 25.4621 33.8808 24.1429 34.4177 22.2388C35.4436 18.7719 37.1521 15.6944 39.6927 13.1539C40.6687 12.1281 41.8421 11.3475 43.2573 10.9067C43.9898 10.6631 44.6743 10.7609 45.357 11.1022C46.3331 11.5414 46.7242 12.2739 46.6762 13.2997C46.5784 14.178 46.1873 14.9602 45.7979 15.6927C44.3809 18.1835 42.5248 20.2832 40.3274 22.1393C39.3993 22.9215 38.3735 23.6043 37.3477 24.239C36.9085 24.4826 36.9085 24.9715 37.3477 25.2648C37.8366 25.5581 38.3238 25.7039 38.9104 25.5581C39.5451 25.4123 40.2296 25.2648 40.8643 25.0212C44.5267 23.6043 49.6061 20.4307 52.5858 17.8902C53.0747 17.4991 53.4641 17.0119 53.905 16.571C54.4917 15.9843 55.0286 15.9363 55.7113 16.3274C56.0527 16.571 56.2483 17.0599 56.0527 17.451C55.9549 17.6466 55.8091 17.8902 55.6616 18.0857C55.0749 18.7204 54.538 19.4049 53.9033 19.9418C50.9733 22.5304 45.9917 25.7057 42.3773 27.1706C41.4012 27.6098 40.3257 27.9529 39.0065 27.9529C37.5896 27.8551 36.1743 27.3182 35.0988 26.0968H35.1022ZM37.4952 21.3107C37.6908 21.3605 37.8863 21.213 38.0819 21.0671C40.1816 19.3088 41.9896 17.3069 43.3568 14.9619C43.6502 14.425 44.2351 13.9361 43.8938 13.1556C43.259 13.2036 42.7701 13.5947 42.2813 13.9859C40.034 15.842 38.521 18.2847 37.4455 21.0191C37.3974 21.1169 37.4455 21.2147 37.4935 21.3125L37.4952 21.3107Z" fill="#F7594E"/>
                    <path d="M49.5577 27.0243C49.5097 26.4874 49.6057 25.9505 49.851 25.4118C50.4377 24.1424 50.9746 22.8232 51.5596 21.5538C52.6335 19.3066 53.7571 17.0611 54.8326 14.7641C55.2238 13.8858 55.6149 13.0058 55.6149 11.98C55.6149 11.8822 55.6629 11.7364 55.7127 11.6386C55.8585 10.9061 56.2496 10.515 56.7385 10.5648C57.5207 10.6128 58.0576 11.1017 58.1057 11.8342C58.1057 12.4209 58.0576 13.0556 57.9599 13.6405C57.9101 14.1294 57.7163 14.5188 57.5687 15.0077C57.8621 15.2033 58.0079 15.0077 58.2035 14.8122L60.1076 12.6147C61.5245 10.9542 64.1611 11.8325 64.6981 13.6405C65.0892 14.8619 65.0892 16.0833 64.8439 17.303C64.7461 17.8399 64.355 18.1332 63.8181 18.1813C63.1336 18.1813 62.5967 17.8399 62.4509 17.2052C62.4028 16.8141 62.4028 16.4727 62.3531 16.0816L62.2073 15.2033C62.2073 15.1055 62.0615 15.0077 62.0117 14.91C61.5726 14.8619 61.377 15.2513 61.1814 15.4966C60.3031 16.6683 59.3751 17.8416 58.5448 19.0613C57.0301 21.3565 55.5651 23.7015 54.0521 25.9968C53.613 26.6315 53.1241 27.2662 52.6352 27.9009C52.2938 28.3898 51.7569 28.5853 51.2182 28.5853C50.1924 28.5853 49.5577 27.9987 49.5577 27.0226V27.0243ZM57.6168 15.157L57.5687 15.0112V15.0592L57.6168 15.157Z" fill="#F7594E"/>
                    <path d="M64.6012 29.956C64.4057 29.4671 64.4554 28.9799 64.6012 28.491C65.0901 26.6846 66.1159 23.2658 66.6031 21.4577C66.7009 21.0666 67.629 18.43 68.7526 15.3045C67.4334 15.4023 66.4573 15.4503 66.3595 15.4503C65.9204 15.4023 65.4812 15.4023 65.1382 15.157C64.7968 14.9134 64.5515 14.6681 64.6012 14.2787C64.6012 13.7898 64.9426 13.692 65.3337 13.644C66.2618 13.5462 67.1898 13.4484 68.1178 13.4004L69.437 13.3026C70.8042 9.54237 72.2692 5.68265 72.8078 4.75632C73.0034 4.3652 73.1492 3.97408 73.3945 3.63271C73.8834 2.70467 74.8115 2.65664 75.4462 3.4869C75.6417 3.78024 75.6897 4.07358 75.592 4.3652C75.4462 4.75632 75.2506 5.14744 75.1031 5.53684C74.4684 7.00181 73.7839 8.46679 73.1989 9.93177L72.0753 13.1551C73.5403 13.0573 74.8595 12.9595 75.2009 12.9595C75.8853 12.9115 76.568 12.8617 77.2525 12.8617C77.5939 12.8617 77.937 12.9595 78.2286 13.3009C78.4241 13.5445 78.4722 13.8378 78.2286 14.0831C77.8872 14.5223 77.4463 14.62 76.9094 14.6698L71.4389 15.1089C69.8264 19.8469 67.5809 26.5371 66.8484 28.7843C66.7507 29.1754 66.6048 29.6146 66.4573 30.0057C66.3115 30.3471 66.0182 30.5924 65.6271 30.5924C65.1382 30.5924 64.7968 30.3968 64.6012 29.9577V29.956Z" fill="#F7594E"/>
                    <path d="M81.6442 26.1954C81.5464 25.7562 81.5464 25.2673 81.4487 24.7785C81.0095 24.7304 80.814 25.1198 80.5206 25.3154C79.8362 25.8523 79.2015 26.439 78.5187 26.9279C78.0796 27.2693 77.5907 27.5146 77.004 27.5146C75.7826 27.5626 75.0021 26.9776 74.8546 25.7562C74.7568 24.974 74.8546 24.1935 75.0982 23.4113C76.124 20.188 77.7845 17.258 79.9339 14.6197C80.5206 13.9352 81.1553 13.6436 82.0336 13.985C82.5225 14.1308 82.7661 14.6694 82.5225 15.1566C82.2789 15.5477 82.0336 15.8411 81.79 16.2305C80.2753 18.3799 78.9579 20.6254 78.0778 23.166C77.9801 23.4095 77.7845 23.7029 77.9801 24.0442C78.5667 23.8487 78.9562 23.3598 79.3473 22.9704C80.8122 21.5054 82.1794 20.0404 83.5964 18.6235C84.3289 17.891 84.9155 17.8413 85.7458 18.3302C86.1369 18.5738 86.3325 18.9649 86.185 19.404C86.0392 19.7951 85.8436 20.1863 85.6961 20.5757C85.1094 21.8948 84.5725 23.31 84.2311 24.727C84.1333 25.1661 84.0355 25.5573 84.1333 25.9964C84.1813 26.2897 84.3769 26.4356 84.6222 26.4356C84.9155 26.3875 85.2089 26.2897 85.5005 26.192C86.5263 25.7528 87.4544 25.1661 88.3327 24.4834C91.4102 22.2859 94.3401 19.8432 96.9767 17.1088C97.1723 16.8652 97.3678 16.6696 97.6114 16.4243C98.0025 16.131 98.3937 16.131 98.8328 16.3265C99.4675 16.6199 99.6631 17.1088 99.272 17.6457C98.7831 18.2804 98.2959 18.9151 97.7092 19.4521C95.2184 22.0887 92.484 24.4337 89.5043 26.5333C88.4305 27.3156 87.2571 28.0481 85.9397 28.3894C85.5485 28.4872 85.1094 28.585 84.6702 28.585C83.0577 28.585 82.0336 27.8028 81.6425 26.192L81.6442 26.1954Z" fill="#F7594E"/>
                    <path d="M92.2911 28.7353C92.437 28.3442 92.6823 28.0028 92.8281 27.6117C93.9997 25.1689 95.1233 22.7279 96.295 20.2851C97.3208 18.1854 97.9555 15.9382 98.1013 13.5932C98.1493 12.9585 98.1493 12.3718 98.3946 11.7869C98.688 11.1024 99.1769 10.9086 99.8596 11.1024C100.544 11.298 100.885 11.7869 100.983 12.4216C101.129 13.1541 101.081 13.8865 100.935 14.619L100.496 16.964C100.985 17.3054 101.374 16.8662 101.765 16.8182C103.378 16.6724 104.354 17.4529 104.354 19.1135C104.402 19.8957 104.306 20.6762 104.208 21.5065C104.062 22.6301 104.013 23.8017 104.062 24.9734C104.11 25.7556 104.502 25.9992 105.136 25.6578C105.821 25.2667 106.406 24.8756 106.992 24.4364C109.727 22.5323 112.218 20.3331 114.563 17.9898C115.051 17.4529 115.588 16.964 116.125 16.4271C116.564 15.9879 117.053 15.8902 117.64 16.0857C118.568 16.3293 118.812 16.964 118.227 17.6982C117.836 18.2352 117.348 18.7721 116.908 19.261C114.417 22.0451 111.682 24.6337 108.653 26.8312C107.677 27.5637 106.651 28.1984 105.38 28.4437C103.671 28.785 101.815 28.1503 101.424 25.9031C101.278 25.0248 101.18 24.0968 101.278 23.1687C101.376 22.3385 101.424 21.4602 101.474 20.6282L101.132 20.4824C100.693 21.069 100.254 21.654 99.863 22.2407C98.3483 24.4879 96.8353 26.7334 95.3206 28.9326C95.0273 29.3717 94.7339 29.7628 94.4423 30.1539C94.0512 30.5931 93.2707 30.6909 92.7337 30.3495C92.2448 30.0562 92.0012 29.4215 92.2946 28.737L92.2911 28.7353Z" fill="#F7594E"/>
                    <path d="M114.517 26.0968C113.98 25.4621 113.295 24.1429 113.832 22.2388C114.858 18.7719 116.567 15.6944 119.107 13.1539C120.083 12.1281 121.257 11.3475 122.672 10.9067C123.404 10.6631 124.089 10.7609 124.772 11.1022C125.748 11.5414 126.139 12.2739 126.091 13.2997C125.993 14.178 125.602 14.9602 125.213 15.6927C123.796 18.1835 121.94 20.2832 119.742 22.1393C118.814 22.9215 117.788 23.6043 116.762 24.239C116.323 24.4826 116.323 24.9715 116.762 25.2648C117.251 25.5581 117.738 25.7039 118.325 25.5581C118.96 25.4123 119.644 25.2648 120.279 25.0212C123.941 23.6043 129.021 20.4307 132 17.8902C132.489 17.4991 132.879 17.0119 133.32 16.571C133.906 15.9843 134.443 15.9363 135.126 16.3274C135.467 16.571 135.663 17.0599 135.467 17.451C135.37 17.6466 135.224 17.8902 135.076 18.0857C134.49 18.7204 133.953 19.4049 133.318 19.9418C130.388 22.5304 125.406 25.7057 121.792 27.1706C120.816 27.6098 119.74 27.9529 118.421 27.9529C117.004 27.8551 115.589 27.3182 114.513 26.0968H114.517ZM116.91 21.3107C117.105 21.3605 117.301 21.213 117.497 21.0671C119.596 19.3088 121.404 17.3069 122.771 14.9619C123.065 14.425 123.65 13.9361 123.308 13.1556C122.674 13.2036 122.185 13.5947 121.696 13.9859C119.449 15.842 117.936 18.2847 116.86 21.0191C116.812 21.1169 116.86 21.2147 116.908 21.3125L116.91 21.3107Z" fill="#F7594E"/>
                </svg>
            </a>
        </div>

        <!-- Header -->
        <div class="form-header">
            <h2 class="form-title">Set New Password</h2>
            <p class="form-subtitle">Enter your new password below</p>
        </div>

        <!-- Messages -->
        <div id="messageContainer">
            <% if (message) { %>
                <div class="alert alert-error show">
                    <span><%= message %></span>
                    <button class="alert-close" onclick="closeAlert(this)">√ó</button>
                </div>
            <% } %>
            <% if (success) { %>
                <div class="alert alert-success show">
                    <span><%= success %></span>
                    <button class="alert-close" onclick="closeAlert(this)">√ó</button>
                </div>
            <% } %>
        </div>

        <!-- Reset Password Form -->
        <form id="resetPasswordForm">
            <div class="form-group">
                <label class="form-label">New Password</label>
                <div class="password-input">
                    <input type="password" class="form-input" name="password" id="resetPassword" placeholder="Enter new password" required>
                    <button type="button" class="toggle-password" onclick="togglePassword('resetPassword')">üëÅ</button>
                </div>
            </div>

            <div class="form-group">
                <label class="form-label">Confirm New Password</label>
                <div class="password-input">
                    <input type="password" class="form-input" name="confirmPassword" id="resetConfirmPassword" placeholder="Confirm new password" required>
                    <button type="button" class="toggle-password" onclick="togglePassword('resetConfirmPassword')">üëÅ</button>
                </div>
            </div>
            
            <button type="submit" class="btn btn-primary" id="resetPasswordBtn">
                <div class="loading-spinner"></div>
                Reset Password
            </button>
        </form>
    </div>

    <script>
        // Go back to forgot password page
        function goBack() {
            window.location.href = '/?auth=forgot-password';
        }

        // Toggle password visibility
        function togglePassword(inputId) {
            const input = document.getElementById(inputId);
            const button = input.nextElementSibling;
            if (input.type === 'password') {
                input.type = 'text';
                button.textContent = 'üëÅÔ∏è';
            } else {
                input.type = 'password';
                button.textContent = 'üëÅ';
            }
        }

        // Show alert
        function showAlert(message, type = 'error') {
            const alertDiv = document.createElement('div');
            alertDiv.className = `alert alert-${type}`;
            alertDiv.innerHTML = `
                <span>${message}</span>
                <button class="alert-close" onclick="closeAlert(this)">√ó</button>
            `;
            
            setTimeout(() => {
                alertDiv.classList.add('show');
            }, 10);
            
            const container = document.getElementById('messageContainer');
            container.innerHTML = '';
            container.appendChild(alertDiv);
            
            // Auto remove after 5 seconds
            setTimeout(() => {
                closeAlert(alertDiv.querySelector('.alert-close'));
            }, 5000);
        }

        // Close alert
        function closeAlert(button) {
            const alert = button.closest('.alert');
            alert.classList.remove('show');
            setTimeout(() => {
                if (alert.parentElement) {
                    alert.remove();
                }
            }, 300);
        }

        // Show loading on button
        function showButtonLoading(button, isLoading) {
            if (isLoading) {
                button.classList.add('loading');
                button.disabled = true;
            } else {
                button.classList.remove('loading');
                button.disabled = false;
            }
        }

        // Handle reset password - FIXED VERSION
        async function resetPassword(event) {
            event.preventDefault();
            event.stopPropagation();
            
            const form = document.getElementById('resetPasswordForm');
            const password = document.getElementById('resetPassword').value;
            const confirmPassword = document.getElementById('resetConfirmPassword').value;
            
            // Validate passwords match
            if (password !== confirmPassword) {
                showAlert('Passwords do not match');
                return false;
            }
            
            
            
            const btn = document.getElementById('resetPasswordBtn');
            showButtonLoading(btn, true);
            
            try {
                const response = await fetch('/api/reset-password', {
                    method: 'POST',
                    headers: { 
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        password: password,
                        confirmPassword: confirmPassword
                    }),
                    credentials: 'include'
                });
                
                const result = await response.json();
                
                if (result.success) {
                    showAlert(result.message, 'success');
                    setTimeout(() => {
                        window.location.href = result.redirect;
                    }, 1500);
                } else {
                    showAlert(result.message);
                    // If session expired, redirect to forgot-password
                    if (result.message.includes('expired') || result.message.includes('invalid')) {
                        setTimeout(() => {
                            window.location.href = '/?auth=forgot-password';
                        }, 2000);
                    }
                }
            } catch (error) {
                console.error('Reset password error:', error);
                showAlert('An error occurred. Please try again.');
            } finally {
                showButtonLoading(btn, false);
            }
            
            return false;
        }

        // Initialize page
        document.addEventListener('DOMContentLoaded', function() {
            // Add event listener to form
            const form = document.getElementById('resetPasswordForm');
            form.addEventListener('submit', resetPassword);
            
            // Check if we have valid session for password reset
            fetch('/api/auth/status', {
                credentials: 'include'
            })
            .then(response => response.json())
            .then(data => {
                // We don't have a specific endpoint to check reset status
                // So we'll let the server handle it via the route middleware
            })
            .catch(error => {
                console.error('Session check error:', error);
            });
        });
    </script>
</body>
</html>
